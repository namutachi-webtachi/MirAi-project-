<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN AREA</title>
    <!-- CSS CH·∫ÆC CH·∫ÆN HI·ªÜN -->
    <style>
        body {
            background-color: black;
            color: lime; /* M√†u xanh l√° hacker */
            font-family: monospace;
            margin: 0;
            overflow: hidden; /* Ch·∫∑n cu·ªôn chu·ªôt khi ch∆∞a m·ªü kh√≥a */
        }
        
        /* M√†n h√¨nh kh√≥a n·∫±m ƒë√® l√™n t·∫•t c·∫£ */
        #lock-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: black;
            z-index: 99999; /* Lu√¥n n·∫±m tr√™n c√πng */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        input {
            background: transparent;
            border: 2px solid lime;
            color: lime;
            font-size: 2rem;
            padding: 10px;
            text-align: center;
            margin-top: 20px;
            outline: none;
            letter-spacing: 5px;
            border-radius: 10px;
        }

        /* ·∫®n n·ªôi dung ch√≠nh ban ƒë·∫ßu */
        #admin-content { display: none; }
    </style>
    <!-- Link CSS ch√≠nh (ch·ªâ d√πng khi ƒë√£ v√†o trong) -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <!-- üëáüëá PH·∫¶N N√ÄY L√Ä C√ÅI M√ÄN H√åNH KH√ìA (KI·ªÇM TRA K·ª∏2006";

        function checkPass(el) {
            if(el.value === PASS) {
                document.getElementById('lock-screen').style.display = 'none'; // ·∫®n kh√≥a
                document.getElementById('admin-content').style.display = 'block'; // Hi·ªán tool
                document.body.style.background = "url('" + (typeof CONFIG !== 'undefined' ? CONFIG.bgImage : '') + "')";
                document.body.style.overflow = "auto";
                
                // Load token c≈© n·∫øu c√≥
                if(localStorage.getItem('gh_token')) document.getElementById('token').value = localStorage.getItem('gh_token');
            } else if (el.value.length >= 4) {
                document.getElementById('msg').innerText = "SAI M·∫¨T KH·∫®U!";
                el.value = "";
            }
        }

        // X·ª≠ l√Ω file TXT
        function handleTxt(el) {
            const reader = new FileReader();
            reader.onload = (e) => {
                let txt = e.target.result.replace(/\r\n/g, "\n").replace(/\n/g, "\n\n");
                document.getElementById('content').value = txt;
            }
            reader.readAsText(el.files[0]);
        }

        // X·ª≠ l√Ω Upload ·∫¢nh
        async function handleImg(el) {
            const file = el.files[0];
            if(!file) return;
            const token = document.getElementById('token').value;
            if(!token) return alert("Ch∆∞a nh·∫≠p Token!");

            document.getElementById('uploadStatus').innerText = "‚è≥ ƒêang upload ·∫£nh...";
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async function() {
                try {
                    const b64 = reader.result.split(',')[1];
                    const name = `images/${Date.now()}_${file.name}`;
                    // Upload
                    await fetch(`https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/${name}`, {
                        method: 'PUT',
                        headers: {'Authorization': `token ${token}`},
                        body: JSON.stringify({message: "img", content: b64})
                    });
                    
                    const url = `https://${CONFIG.adminUser}.github.io/${CONFIG.repoName}/${name}`;
                    const textArea = document.getElementById('content');
                    textArea.value = `![Img](${url})\n` + textArea.value;
                    document.getElementById('uploadStatus').innerText = "‚úÖ ·∫¢nh ƒë√£ l√™n!";
                } catch(e) { alert("L·ªói: " + e); }
            }
        }

        // ƒêƒÉng b√†i
        async function publish() {
            const token = document.getElementById('token').value;
            const title = document.getElementById('chapTitle').value;
            const content = document.getElementById('content').value;
            const status = document.getElementById('status');
            
            if(!token || !title || !content) return alert("Thi·∫øu th√¥ng tin!");
            status.innerText = "‚è≥ ƒêang x·ª≠ l√Ω...";
            
            try {
                // 1. Up file
                const id = `chap_${Date.now()}`;
                const path = `chapters/${id}.md`;
                const b64 = btoa(unescape(encodeURIComponent(content)));
                
                await fetch(`https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/${path}`, {
                    method: 'PUT',
                    headers: {'Authorization': `token ${token}`},
                    body: JSON.stringify({message: `Add ${title}`, content: b64})
                });

                // 2. Update list
                const jsonRes = await fetch(`https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/data.json`, {
                    headers: {'Authorization': `token ${token}`}
                });
                const jsonData = await jsonRes.json();
                const list = JSON.parse(decodeURIComponent(escape(atob(jsonData.content))));
                list.push({id: id, title: title, file: path});
                
                await fetch(`https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/data.json`, {
                    method: 'PUT',
                    headers: {'Authorization': `token ${token}`},
                    body: JSON.stringify({
                        message: "Update list",
                        content: btoa(unescape(encodeURIComponent(JSON.stringify(list, null, 2)))),
                        sha: jsonData.sha
                    })
                });

                status.innerText = "üéâ TH√ÄNH C√îNG!";
            } catch(e) { status.innerText = "‚ùå L·ªói: " + e; }
        }
    </script>
</body>
</html>
