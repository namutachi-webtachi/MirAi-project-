<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RESTRICTED AREA</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Giao di·ªán m√†n h√¨nh kh√≥a Hacker */
        body { background: #000; color: #0f0; font-family: 'Courier New', Courier, monospace; overflow: hidden; }
        .lock-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 9999; background: #000;
        }
        .lock-icon { font-size: 5rem; margi2006"; 
        // ======================================================

        // H√†m ki·ªÉm tra Pass
        function checkAccess(e) {
            const input = document.getElementById('pin');
            const val = input.value;
            const msg = document.getElementById('msg');

            // N·∫øu nh·∫•n Enter ho·∫∑c nh·∫≠p ƒë·ªß k√Ω t·ª±
            if (val.length === SECRET_CODE.length) {
                if (val === SECRET_CODE) {
                    msg.style.color = "#0f0";
                    msg.innerText = "ACCESS GRANTED... SYSTEM LOADING...";
                    
                    // Hi·ªáu ·ª©ng m·ªü kh√≥a
                    setTimeout(() => {
                        document.getElementById('lock-screen').style.display = 'none';
                        document.body.style.background = "url('" + CONFIG.bgImage + "')";
                        document.body.style.overflow = "auto";
                        renderAdminInterface(); // <--- G·ªåI H√ÄM V·∫º GIAO DI·ªÜN
                    }, 1000);
                } else {
                    msg.innerText = "TRUY C·∫¨P B·ªä T·ª™ CH·ªêI!";
                    input.value = "";
                    input.style.borderColor = "red";
                    setTimeout(() => input.style.borderColor = "#0f0", 500);
                }
            }
        }

        // H√ÄM V·∫º GIAO DI·ªÜN ADMIN (Ch·ªâ ch·∫°y khi ƒë√∫ng Pass)
        function renderAdminInterface() {
            const app = document.getElementById('admin-app');
            app.style.display = 'block';
            
            // Ti√™m HTML v√†o (K·∫ª gian kh√¥ng th·ªÉ Inspect ƒë·ªÉ th·∫•y c√°i n√†y t·ª´ ƒë·∫ßu)
            app.innerHTML = `
                <header class="glass-box" style="text-align: center; margin-top: 40px;">
                    <h2 style="color: var(--primary)">üõ† TRUNG T√ÇM ƒêI·ªÄU KHI·ªÇN</h2>
                    <a href="index.html" class="btn btn-outline">‚¨Ö Tho√°t</a>
                </header>

                <div class="glass-box">
                    <h3>üîë Token GitHub</h3>
                    <input type="password" id="token" placeholder="GitHub Token (ghp_...)" onchange="saveToken()">
                </div>

                <div class="glass-box">
                    <h3>üìù ƒêƒÉng Ch∆∞∆°ng M·ªõi</h3>
                    
                    <input type="text" id="chapTitle" placeholder="Ti√™u ƒë·ªÅ ch∆∞∆°ng (VD: Ch∆∞∆°ng 1)">

                    <div class="file-drop" onclick="document.getElementById('txtInput').click()">
                        <input type="file" id="txtInput" accept=".txt" hidden onchange="handleTxt()">
                        üìÇ <b>Import File .TXT</b>
                    </div>

                    <div class="file-drop" onclick="document.getElementById('imgInput').click()">
                        <input type="file" id="imgInput" accept="image/*" hidden onchange="handleImg()">
                        üñº <b>Upload ·∫¢nh Minh H·ªça</b>
                    </div>
                    <p id="imgStatus" style="color: var(--primary); text-align: center;"></p>

                    <textarea id="content" rows="15" placeholder="N·ªôi dung truy·ªán..."></textarea>
                    
                    <button class="btn" onclick="publish()" style="width: 100%; justify-content: center; font-size: 1.2rem; margin-top: 15px;">üöÄ K√çCH HO·∫†T ƒêƒÇNG B√ÄI</button>
                    <div id="status" class="status"></div>
                </div>
            `;

            // Kh√¥i ph·ª•c Token n·∫øu ƒë√£ l∆∞u
            if(localStorage.getItem('gh_token')) document.getElementById('token').value = localStorage.getItem('gh_token');
        }

        // === C√ÅC H√ÄM X·ª¨ L√ù LOGIC (Gi·ªØ nguy√™n nh∆∞ c≈©) ===
        function saveToken() { localStorage.setItem('gh_token', document.getElementById('token').value); }

        function handleTxt() {
            const file = document.getElementById('txtInput').files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                let text = e.target.result;
                text = text.replace(/\r\n/g, "\n").replace(/\n/g, "\n\n");
                document.getElementById('content').value = text;
            };
            reader.readAsText(file);
        }

        async function handleImg() {
            const file = document.getElementById('imgInput').files[0];
            if(!file) return;
            const token = document.getElementById('token').value;
            if(!token) return alert("C·∫ßn Token!");

            document.getElementById('imgStatus').innerText = "‚è≥ Uploading...";
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async function() {
                try {
                    const base64 = reader.result.split(',')[1];
                    const fileName = `images/${Date.now()}_${file.name}`;
                    await githubReq(fileName, base64, "Up Img", token);
                    
                    const imgUrl = `https://${CONFIG.adminUser}.github.io/${CONFIG.repoName}/${fileName}`;
                    const txtArea = document.getElementById('content');
                    txtArea.value = `\n![Img](${imgUrl})\n` + txtArea.value;
                    document.getElementById('imgStatus').innerText = "‚úÖ Done!";
                } catch(e) { alert("Error: " + e); }
            }
        }

        async function publish() {
            const token = document.getElementById('token').value;
            const title = document.getElementById('chapTitle').value;
            const content = document.getElementById('content').value;
            const status = document.getElementById('status');

            if(!token || !title || !content) return alert("Thi·∫øu d·ªØ li·ªáu!");
            
            status.innerText = "‚è≥ ƒêang k·∫øt n·ªëi v·ªá tinh...";
            status.style.color = "blue";

            try {
                const fileId = `chap_${Date.now()}`;
                const filePath = `chapters/${fileId}.md`;
                const contentB64 = btoa(unescape(encodeURIComponent(content)));
                await githubReq(filePath, contentB64, `New: ${title}`, token);

                const jsonUrl = `https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/data.json`;
                const getRes = await fetch(jsonUrl, { headers: {Authorization: `token ${token}`} });
                let list = [], sha = null;
                
                if(getRes.ok) {
                    const data = await getRes.json();
                    sha = data.sha;
                    list = JSON.parse(decodeURIComponent(escape(atob(data.content))));
                }

                list.push({ id: fileId, title: title, file: filePath });
                const jsonB64 = btoa(unescape(encodeURIComponent(JSON.stringify(list, null, 2))));
                await githubReq("data.json", jsonB64, "Update List", token, sha);

                status.innerText = "üéâ ƒêƒÇNG T·∫¢I TH√ÄNH C√îNG!";
                status.style.color = "green";
                document.getElementById('content').value = '';
                document.getElementById('chapTitle').value = '';
            } catch(e) {
                status.innerText = "‚ùå TH·∫§T B·∫†I: " + e.message;
                status.style.color = "red";
            }
        }

        async function githubReq(path, content, msg, token, sha=null) {
            const body = { message: msg, content: content };
            if(sha) body.sha = sha;
            const res = await fetch(`https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/${path}`, {
                method: 'PUT',
                headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });
            if(!res.ok) throw new Error((await res.json()).message);
        }
    </script>
</body>
</html>
