<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>404 Not Found</title> <!-- ƒê·∫∑t t√™n gi·∫£ ƒë·ªÉ l·ª´a t√¨nh -->
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* M·∫∑c ƒë·ªãnh ·∫©n m·ªçi th·ª©, n·ªÅn ƒëen */
        body { background-color: #000; margin: 0; overflow: hidden; }
        
        /* Tool Admin (M·∫∑c ƒë·ªãnh ·∫©n) */
        #admin-panel { display: none; padding-bottom: 50px; }
        
        /* Hi·ªáu ·ª©ng khi hi·ªán ra */
        .reveal { animation: fadeIn 1s forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <!-- PH·∫¶N TOOL N·∫∞M ·∫®N ·ªû ƒê√ÇY -->
    <div id="admin-panel" class="container">
        <header class="glass-box" style="text-align: center; margin-top: 30px;">
            <h2 style="color: var(--primary);">üöÄ TRUNG T√ÇM ƒêI·ªÄU KHI·ªÇN</h2>
            <p style="color: #666;">Ch√†o m·ª´ng tr·ªü l·∫°i, Boss!</p>
            <a href="index.html" class="btn btn-outline">‚¨Ö Tho√°t</a>
        </header>

        <div class="glass-box">
            <h3>üîë Token GitHub</h3>
            <input type="password" id="token" placeholder="GitHub Token (ghp_...)" onchange="saveToken()">
        </div>

        <div class="glass-box">
            <h3>üìù ƒêƒÉng Truy·ªán M·ªõi</h3>
            <input type="text" id="chapTitle" placeholder="Ti√™u ƒë·ªÅ ch∆∞∆°ng (VD: Ch∆∞∆°ng 1)">

            <div class="file-drop" onclick="document.getElementById('txtInput').click()">
                <input type="file" id="txtInput" accept=".txt" hidden onchange="handleTxt()">
                üìÇ <b>Import File .TXT</b>
            </div>

            <div class="file-drop" onclick="document.getElementById('imgInput').click()">
                <input type="file" id="imgInput" accept="image/*" hidden onchange="handleImg()">
                üñº <b>Upload ·∫¢nh Minh H·ªça</b>
            </div>
            <p id="imgStatus" style="color: var(--primary); text-align: center; font-size: 0.9rem;"></p>

            <textarea id="content" rows="15" placeholder="N·ªôi dung truy·ªán..."></textarea>
            
            <button class="btn" onclick="publish()" style="width: 100%; margin-top: 20px;">üöÄ ƒêƒÇNG B√ÄI</button>
            <div id="status" style="text-align: center; margin-top: 10px; font-weight: bold;"></div>
        </div>
    </div>

    <!-- SCRIPT X·ª¨ L√ù -->
    <script src="config.js"></script>
    <script>
        // ===========================================
        // üîê M·∫¨T KH·∫®U C·ª¶A BRO (S·ªê N√ÄO C≈®NG ƒê∆Ø·ª¢C)
        const SECRET_PASS = "2006";
        // ===========================================

        // In h∆∞·ªõng d·∫´n ra m√†n h√¨nh Console cho Bro nh·ªõ
        console.log("%cüõë H·ªÜ TH·ªêNG ƒê√É KH√ìA!", "color: red; font-size: 30px; font-weight: bold;");
        console.log("%cMu·ªën truy c·∫≠p? H√£y nh·∫≠p l·ªánh: login('M·∫¨T_KH·∫®U')", "color: yellow; font-size: 16px;");

        // H√†m m·ªü kh√≥a (G√µ v√†o console m·ªõi ch·∫°y)
        window.login = function(pass) {
            if(pass === SECRET_PASS) {
                console.clear();
                console.log("%c‚úÖ ƒê√É M·ªû KH√ìA! WELCOME BOSS.", "color: lime; font-size: 20px;");
                
                // Hi·ªán giao di·ªán
                document.body.style.backgroundColor = "#f1f2f6"; // Tr·∫£ l·∫°i m√†u n·ªÅn web
                document.body.style.backgroundImage = `url('${CONFIG.bgImage}')`;
                document.body.style.overflow = "auto";
                
                const panel = document.getElementById('admin-panel');
                panel.style.display = "block";
                panel.classList.add('reveal');

                // Load token c≈©
                if(localStorage.getItem('gh_token')) document.getElementById('token').value = localStorage.getItem('gh_token');
            } else {
                console.log("%c‚ùå SAI M·∫¨T KH·∫®U!", "color: red; font-size: 20px;");
            }
        }

        // --- C√ÅC H√ÄM X·ª¨ L√ù C≈® (GI·ªÆ NGUY√äN) ---
        function saveToken() { localStorage.setItem('gh_token', document.getElementById('token').value); }
        
        function handleTxt() {
            const file = document.getElementById('txtInput').files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                let txt = e.target.result.replace(/\r\n/g, "\n").replace(/\n/g, "\n\n");
                document.getElementById('content').value = txt;
            }
            reader.readAsText(file);
        }

        async function handleImg() {
            const file = document.getElementById('imgInput').files[0];
            if(!file) return;
            const token = document.getElementById('token').value;
            if(!token) return alert("C·∫ßn Token!");

            document.getElementById('imgStatus').innerText = "‚è≥ ƒêang upload...";
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async function() {
                try {
                    const b64 = reader.result.split(',')[1];
                    const name = `images/${Date.now()}_${file.name}`;
                    await githubReq(name, b64, "Img", token);
                    const url = `https://${CONFIG.adminUser}.github.io/${CONFIG.repoName}/${name}`;
                    const ta = document.getElementById('content');
                    ta.value = `![Img](${url})\n` + ta.value;
                    document.getElementById('imgStatus').innerText = "‚úÖ Xong!";
                } catch(e) { alert(e); }
            }
        }

        async function publish() {
            const token = document.getElementById('token').value;
            const title = document.getElementById('chapTitle').value;
            const content = document.getElementById('content').value;
            const status = document.getElementById('status');
            
            if(!token || !title || !content) return alert("Thi·∫øu th√¥ng tin!");
            status.innerText = "‚è≥ ƒêang x·ª≠ l√Ω..."; status.style.color = "blue";
            
            try {
                const id = `chap_${Date.now()}`;
                const path = `chapters/${id}.md`;
                const b64 = btoa(unescape(encodeURIComponent(content)));
                await githubReq(path, b64, `New: ${title}`, token);

                const jsonUrl = `https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/data.json`;
                const getRes = await fetch(jsonUrl, {headers: {'Authorization': `token ${token}`}});
                let list = [], sha = null;
                if(getRes.ok) {
                    const d = await getRes.json();
                    sha = d.sha;
                    list = JSON.parse(decodeURIComponent(escape(atob(d.content))));
                }
                list.push({id: id, title: title, file: path});
                const jsonB64 = btoa(unescape(encodeURIComponent(JSON.stringify(list, null, 2))));
                await githubReq("data.json", jsonB64, "Update List", token, sha);
                
                status.innerText = "üéâ TH√ÄNH C√îNG!"; status.style.color = "green";
                document.getElementById('content').value = '';
                document.getElementById('chapTitle').value = '';
            } catch(e) { status.innerText = "‚ùå L·ªói: " + e; status.style.color = "red"; }
        }

        async function githubReq(path, content, msg, token, sha=null) {
            const body = { message: msg, content: content };
            if(sha) body.sha = sha;
            const res = await fetch(`https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/${path}`, {
                method: 'PUT',
                headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });
            if(!res.ok) throw new Error((await res.json()).message);
        }
    </script>
</body>
</html>
