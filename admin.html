<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>404 Not Found</title> <!-- Ng·ª•y trang -->
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Giao di·ªán m·∫∑c ƒë·ªãnh: ƒêen th√πi l√πi */
        body { background-color: #000; margin: 0; overflow: hidden; font-family: monospace; }
        
        /* Panel Admin (·∫®n) */
        #admin-panel { display: none; padding-bottom: 50px; background: #f4f4f4; min-height: 100vh; overflow-y: auto; }
        
        /* Hi·ªáu ·ª©ng hi·ªán h√¨nh */
        .reveal { animation: fadeIn 1s forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Tabs chuy·ªÉn ƒë·ªïi */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 10px; cursor: pointer; background: #ddd; border: none; border-radius: 5px; font-weight: bold; transition: 0.3s; }
        .tab-btn:hover { opacity: 0.8; }
        .tab-btn.active { background: var(--primary); color: white; }

        /* Danh s√°ch ch∆∞∆°ng */
        .chapter-row {
            display: flex; justify-content: space-between; align-items: center;
            background: white; padding: 10px; margin-bottom: 8px; border-radius: 8px; border: 1px solid #ddd;
        }
        .chapter-row:hover { border-color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        /* N√∫t thao t√°c */
        .action-group { display: flex; gap: 5px; }
        .btn-action { padding: 5px 12px; border-radius: 4px; cursor: pointer; border: none; color: white; font-weight: bold; }
        .edit-btn { background: #f39c12; }
        .del-btn { background: #e74c3c; }
        .del-btn:hover { background: #c0392b; }
    </style>
</head>
<body>

    <!-- M√ÄN H√åNH ƒêEN (CH·ªú L·ªÜNH HACK) -->
    <div id="black-screen" style="height: 100vh; width: 100vw; display: flex; justify-content: center; align-items: center; color: #333;">
        <p>System Halted.</p>
    </div>

    <!-- ADMIN PANEL (S·∫Ω hi·ªán khi login th√†nh c√¥ng) -->
    <div id="admin-panel" class="container">
        <header class="glass-box" style="text-align: center; margin-top: 30px;">
            <h2 style="color: var(--primary);">‚ò†Ô∏è GOD MODE ADMIN</h2>
            <p style="color: #666;">Quy·ªÅn l·ª±c tuy·ªát ƒë·ªëi trong tay b·∫°n</p>
            <a href="index.html" class="btn btn-outline">‚¨Ö Tho√°t</a>
        </header>

        <div class="glass-box">
            <h3>üîë Token GitHub</h3>
            <input type="password" id="token" placeholder="GitHub Token (ghp_...)" onchange="saveToken()">
        </div>

        <!-- MENU TABS -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('new')">üìù ƒêƒÉng M·ªõi</button>
            <button class="tab-btn" onclick="switchTab('list')">üìã Qu·∫£n L√Ω (S·ª≠a/X√≥a)</button>
        </div>

        <!-- TAB 1: EDITOR (ƒêƒÉng & S·ª≠a) -->
        <div id="tab-editor" class="glass-box">
            <h3 id="editor-title">üìù So·∫°n Th·∫£o</h3>
            <input type="hidden" id="edit-index" value=""> <!-- L∆∞u v·ªã tr√≠ ƒëang s·ª≠a -->
            <input type="hidden" id="edit-file-sha" value=""> <!-- L∆∞u SHA file md -->

            <input type="text" id="chapTitle" placeholder="Ti√™u ƒë·ªÅ ch∆∞∆°ng">
            
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <div class="file-drop" style="flex: 1;" onclick="document.getElementById('txtInput').click()">
                    üìÇ Import TXT
                    <input type="file" id="txtInput" accept=".txt" hidden onchange="handleTxt()">
                </div>
                <div class="file-drop" style="flex: 1;" onclick="document.getElementById('imgInput').click()">
                    üñº Up ·∫¢nh
                    <input type="file" id="imgInput" accept="image/*" hidden onchange="handleImg()">
                </div>
            </div>
            <p id="imgStatus" style="text-align: center; color: blue; font-size: 0.8rem;"></p>

            <textarea id="content" rows="15" placeholder="N·ªôi dung..."></textarea>
            
            <button id="publishBtn" class="btn" onclick="publish()" style="width: 100%; margin-top: 10px;">üöÄ ƒêƒÇNG B√ÄI</button>
            <button id="cancelBtn" class="btn" onclick="resetForm()" style="width: 100%; margin-top: 10px; background: gray; display: none;">H·ªßy S·ª≠a</button>
            <p id="status" style="text-align: center; font-weight: bold; margin-top: 10px;"></p>
        </div>

        <!-- TAB 2: LIST (Danh s√°ch) -->
        <div id="tab-list" class="glass-box" style="display: none;">
            <h3>üìã Danh s√°ch ch∆∞∆°ng</h3>
            <button class="btn btn-outline" onclick="loadList()" style="width: 100%; margin-bottom: 15px;">üîÑ L√†m m·ªõi</button>
            <div id="list-container">ƒêang t·∫£i...</div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        // ==========================================
        // üîê M·∫¨T KH·∫®U HACKER C·ª¶A BRO
        const SECRET_PASS = "2006"; 
        // ==========================================

        // --- C∆† CH·∫æ LOGIN F12 ---
        console.log("%cüõë SYSTEM LOCKED", "color: red; font-size: 30px; font-weight: bold;");
        console.log("%cG√µ l·ªánh: login('MAT_KHAU') ƒë·ªÉ truy c·∫≠p.", "color: yellow; font-size: 16px;");

        window.login = function(pass) {
            if(pass === SECRET_PASS) {
                console.clear();
                console.log("%c‚úÖ ACCESS GRANTED", "color: lime; font-size: 20px;");
                document.getElementById('black-screen').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                document.body.style.backgroundColor = "#f4f4f4";
                document.body.style.backgroundImage = `url('${CONFIG.bgImage}')`;
                document.body.style.overflow = "auto";
                if(localStorage.getItem('gh_token')) document.getElementById('token').value = localStorage.getItem('gh_token');
            } else {
                console.log("%c‚ùå WRONG PASSWORD", "color: red;");
            }
        }

        // --- CHUY·ªÇN TAB ---
        function switchTab(t) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            if(t === 'new') {
                document.getElementById('tab-editor').style.display = 'block';
                document.getElementById('tab-list').style.display = 'none';
                document.querySelector('button[onclick="switchTab(\'new\')"]').classList.add('active');
            } else {
                document.getElementById('tab-editor').style.display = 'none';
                document.getElementById('tab-list').style.display = 'block';
                document.querySelector('button[onclick="switchTab(\'list\')"]').classList.add('active');
                loadList();
            }
        }

        // --- LOAD DANH S√ÅCH ---
        async function loadList() {
            const t = document.getElementById('token').value;
            if(!t) return document.getElementById('list-container').innerHTML = "Ch∆∞a nh·∫≠p Token!";
            
            try {
                const res = await fetch(`https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/data.json?t=${Date.now()}`);
                const data = await res.json();
                window.chapters = JSON.parse(decodeURIComponent(escape(atob(data.content))));
                window.jsonSha = data.sha; // L∆∞u SHA ƒë·ªÉ update/x√≥a

                const container = document.getElementById('list-container');
                container.innerHTML = '';
                window.chapters.forEach((chap, i) => {
                    container.innerHTML += `
                        <div class="chapter-row">
                            <div><b>#${i+1}:</b> ${chap.title}</div>
                            <div class="action-group">
                                <button class="btn-action edit-btn" onclick="editChap(${i})">‚úèÔ∏è S·ª≠a</button>
                                <button class="btn-action del-btn" onclick="delChap(${i})">üóë X√≥a</button>
                            </div>
                        </div>
                    `;
                });
            } catch(e) { document.getElementById('list-container').innerHTML = "L·ªói: " + e; }
        }

        // --- S·ª¨A CH∆Ø∆†NG ---
        async function editChap(index) {
            const chap = window.chapters[index];
            switchTab('new');
            document.getElementById('status').innerText = "‚è≥ ƒêang t·∫£i n·ªôi dung...";
            
            try {
                const res = await fetch(`https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/${chap.file}?t=${Date.now()}`);
                const data = await res.json();
                
                document.getElementById('chapTitle').value = chap.title;
                document.getElementById('content').value = decodeURIComponent(escape(atob(data.content)));
                document.getElementById('edit-index').value = index;
                document.getElementById('edit-file-sha').value = data.sha;
                
                document.getElementById('editor-title').innerText = "‚úèÔ∏è ƒêang S·ª≠a: " + chap.title;
                document.getElementById('publishBtn').innerText = "üíæ C·∫¨P NH·∫¨T";
                document.getElementById('publishBtn').style.background = "#f39c12";
                document.getElementById('cancelBtn').style.display = "block";
                document.getElementById('status').innerText = "";
            } catch(e) { alert("L·ªói t·∫£i b√†i: " + e); }
        }

        // --- X√ìA CH∆Ø∆†NG (T√çNH NƒÇNG M·ªöI) ---
        async function delChap(index) {
            const chap = window.chapters[index];
            const t = document.getElementById('token').value;
            
            if(!confirm(`‚ö†Ô∏è C·∫¢NH B√ÅO!\nB·∫°n c√≥ ch·∫Øc mu·ªën X√ìA Vƒ®NH VI·ªÑN ch∆∞∆°ng:\n"${chap.title}" kh√¥ng?`)) return;
            
            document.getElementById('list-container').innerHTML = "‚è≥ ƒêang x√≥a file tr√™n server...";
            
            try {
                // 1. L·∫•y SHA c·ªßa file .md ƒë·ªÉ x√≥a
                const fileRes = await fetch(`https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/${chap.file}`);
                const fileData = await fileRes.json();
                
                // 2. G·ª≠i l·ªánh DELETE file .md
                await fetch(`https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/${chap.file}`, {
                    method: 'DELETE',
                    headers: { Authorization: `token ${t}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: `Delete ${chap.title}`, sha: fileData.sha })
                });

                // 3. X√≥a kh·ªèi data.json
                window.chapters.splice(index, 1); // C·∫Øt b·ªè kh·ªèi m·∫£ng
                
                // 4. Update l·∫°i data.json
                const jsonB64 = btoa(unescape(encodeURIComponent(JSON.stringify(window.chapters, null, 2))));
                await fetch(`https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/data.json`, {
                    method: 'PUT',
                    headers: { Authorization: `token ${t}` },
                    body: JSON.stringify({ message: "Delete item", content: jsonB64, sha: window.jsonSha })
                });

                alert("‚úÖ ƒê√£ x√≥a th√†nh c√¥ng!");
                loadList(); // Load l·∫°i danh s√°ch
            } catch(e) { alert("L·ªói khi x√≥a: " + e); loadList(); }
        }

        // --- PUBLISH / UPDATE ---
        async function publish() {
            const t = document.getElementById('token').value;
            const title = document.getElementById('chapTitle').value;
            const content = document.getElementById('content').value;
            const idx = document.getElementById('edit-index').value;
            const status = document.getElementById('status');

            if(!t || !title || !content) return alert("Thi·∫øu th√¥ng tin!");
            status.innerText = "‚è≥ ƒêang x·ª≠ l√Ω...";

            try {
                // L·∫•y data.json m·ªõi nh·∫•t
                const jsonRes = await fetch(`https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/data.json`, {headers:{Authorization:`token ${t}`}});
                const jsonData = await jsonRes.json();
                let list = JSON.parse(decodeURIComponent(escape(atob(jsonData.content))));
                
                let filePath, fileSha = null;
                
                if(idx !== "") { // Ch·∫ø ƒë·ªô S·ª≠a
                    filePath = list[idx].file;
                    fileSha = document.getElementById('edit-file-sha').value;
                    list[idx].title = title;
                } else { // Ch·∫ø ƒë·ªô M·ªõi
                    const id = `chap_${Date.now()}`;
                    filePath = `chapters/${id}.md`;
                    list.push({id: id, title: title, file: filePath});
                }

                // Upload file .md
                const b64 = btoa(unescape(encodeURIComponent(content)));
                const body = { message: `Update ${title}`, content: b64 };
                if(fileSha) body.sha = fileSha;
                
                await fetch(`https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/${filePath}`, {
                    method: 'PUT', headers: {Authorization: `token ${t}`}, body: JSON.stringify(body)
                });

                // Update data.json
                const jsonB64 = btoa(unescape(encodeURIComponent(JSON.stringify(list, null, 2))));
                await fetch(`https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/data.json`, {
                    method: 'PUT', headers: {Authorization: `token ${t}`}, 
                    body: JSON.stringify({ message: "Update list", content: jsonB64, sha: jsonData.sha })
                });

                status.innerText = "üéâ TH√ÄNH C√îNG!";
                if(idx !== "") { switchTab('list'); resetForm(); }
                else { document.getElementById('content').value=''; document.getElementById('chapTitle').value=''; }
                
            } catch(e) { status.innerText = "L·ªói: " + e; }
        }

        // --- HELPER ---
        function resetForm() {
            document.getElementById('chapTitle').value=''; document.getElementById('content').value='';
            document.getElementById('edit-index').value=''; document.getElementById('edit-file-sha').value='';
            document.getElementById('publishBtn').innerText="üöÄ ƒêƒÇNG B√ÄI"; 
            document.getElementById('publishBtn').style.background="var(--primary)";
            document.getElementById('cancelBtn').style.display="none";
            document.getElementById('editor-title').innerText="üìù So·∫°n Th·∫£o";
        }
        function saveToken() { localStorage.setItem('gh_token', document.getElementById('token').value); }
        function handleTxt() {
            const r=new FileReader(); r.onload=e=>document.getElementById('content').value=e.target.result.replace(/\r\n/g,"\n").replace(/\n/g,"\n\n");
            r.readAsText(document.getElementById('txtInput').files[0]);
        }
        async function handleImg() {
            const f=document.getElementById('imgInput').files[0]; if(!f)return;
            const t=document.getElementById('token').value;
            document.getElementById('imgStatus').innerText="Uploading...";
            const r=new FileReader(); r.readAsDataURL(f);
            r.onload=async function(){
                try{
                    const b64=r.result.split(',')[1]; const n=`images/${Date.now()}_${f.name}`;
                    await fetch(`https://api.github.com/repos/${CONFIG.adminUser}/${CONFIG.repoName}/contents/${n}`,{
                        method:'PUT',headers:{Authorization:`token ${t}`},body:JSON.stringify({message:"img",content:b64})
                    });
                    const url=`https://${CONFIG.adminUser}.github.io/${CONFIG.repoName}/${n}`;
                    const ta=document.getElementById('content'); ta.value=`![Img](${url})\n`+ta.value;
                    document.getElementById('imgStatus').innerText="‚úÖ Done";
                }catch(e){alert(e);}
            }
        }
    </script>
</body>
</html>
