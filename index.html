<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Project-MirAiMirAi</title></title>
  <meta name="description" content="Template web truy·ªán: dark mode, TOC, navigation, reading progress, comments placeholder" />

  <!-- Basic styles (feel free to replace with Tailwind if desired) -->
  <style>
    :root{
      --bg:#f7f7f7; --text:#111; --muted:#666; --accent:#7c3aed;
      --card:#fff; --shadow: 0 6px 18px rgba(18,18,18,0.06);
      --max-width:780px;
    }
    [data-theme="dark"]{ --bg:#0b0b0d; --text:#e6e6e9; --muted:#9aa0a6; --card:#0f1113; --accent:#8b5cf6; --shadow: 0 8px 30px rgba(0,0,0,0.6);} 

    html,body{height:100%;}
    body{margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}

    header{position:sticky;top:0;z-index:40;background:linear-gradient(180deg, rgba(255,255,255,0.6), transparent);backdrop-filter: blur(6px);border-bottom:1px solid rgba(0,0,0,0.04);} 
    [data-theme="dark"] header{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-bottom:1px solid rgba(255,255,255,0.03);} 

    .container{max-width:1200px;margin:0 auto;padding:18px;display:grid;grid-template-columns:1fr 320px;gap:28px;align-items:start}
    main{max-width:var(--max-width);margin:0 auto;background:transparent}
    .card{background:var(--card);box-shadow:var(--shadow);border-radius:12px;padding:22px}

    .title{font-size:22px;font-weight:700;margin:6px 0}
    .meta{color:var(--muted);font-size:13px;margin-bottom:12px}

    /* reading controls */
    .controls{display:flex;gap:8px;align-items:center;margin-bottom:14px}
    .btn{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:8px 10px;border-radius:8px;cursor:pointer}
    [data-theme="dark"] .btn{border:1px solid rgba(255,255,255,0.04)}

    .content{line-height:1.85;font-size:18px;color:var(--text)}
    .content p{margin:12px 0}

    /* progress bar */
    .progress-wrap{height:6px;background:rgba(0,0,0,0.06);border-radius:999px;overflow:hidden;margin-top:6px}
    .progress{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#3b82f6)}

    /* Sidebar */
    aside{position:relative}
    .toc{position:sticky;top:88px}
    .toc h3{margin:0 0 10px 0}
    .toc ul{list-style:none;padding:0;margin:0}
    .toc li{margin:8px 0}
    .toc a{color:var(--text);text-decoration:none}

    /* footer actions */
    .nav-row{display:flex;justify-content:space-between;margin-top:18px}

    /* small screens */
    @media (max-width:900px){
      .container{grid-template-columns:1fr}
      aside{order:2}
      header{position:static}
    }

    /* small niceties */
    .fade{opacity:0;transform:translateY(6px);transition:all .45s cubic-bezier(.2,.9,.3,1)}
    .fade.in{opacity:1;transform:none}

    .back-to-top{position:fixed;right:18px;bottom:18px;padding:10px;border-radius:10px;box-shadow:var(--shadow);background:var(--card);cursor:pointer}

    /* reading progress indicator (chapter percent) */
    .reading-progress-bubble{position:fixed;left:18px;bottom:18px;padding:8px 10px;border-radius:999px;background:var(--card);box-shadow:var(--shadow);font-weight:600}
  </style>
</head>
<body>
  <header class="card" style="margin:12px auto 16px;max-width:1200px;">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
      <div>
        <div class="title">Project-MirAi </div>
        <div class="meta">T√°c gi·∫£: NamuTachi  / <strong>MirAi</strong></div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="toggleTheme" class="btn" title="Chuy·ªÉn giao di·ªán">üåô</button>
        <div style="display:flex;align-items:center;gap:8px">
          <button id="fontDec" class="btn">A-</button>
          <button id="fontInc" class="btn">A+</button>
        </div>
        <button id="tocToggle" class="btn">üìö M·ª•c l·ª•c</button>
      </div>
    </div>
    <div class="progress-wrap" style="margin-top:12px">
      <div id="siteProgress" class="progress"></div>
    </div>
  </header>

  <div class="container">
    <main>
      <article id="chapter" class="card fade">
        <div id="chapterHeader">
          <h1 id="chapterTitle">Ch∆∞∆°ng 1 </h1>
          <div class="meta">C·∫≠p nh·∫≠t: <span id="chapterDate">2025-12-0606</span> </div>
        </div>

        <div class="controls"06"},
      
    ];

    // If you prefer to embed chapter content directly in this file, set USE_EXTERNAL_CHAPTERS = false and paste HTML content into the #content element within <article>.
    const USE_EXTERNAL_CHAPTERS = true;

    /* ---------- Utilities ---------- */
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    /* ---------- Theme (dark/light) ---------- */
    function applyTheme(theme){
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      $('#toggleTheme').textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    }
    const savedTheme = localStorage.getItem('theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme:dark)').matches ? 'dark' : 'light');
    applyTheme(savedTheme);
    $('#toggleTheme').addEventListener('click', ()=> applyTheme(document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'));
    $('#themeMini').addEventListener('click', ()=> $('#toggleTheme').click());

    /* ---------- Font controls ---------- */
    const content = $('#content');
    function setFontSize(size){ content.style.fontSize = size + 'px'; localStorage.setItem('fontSize', size); }
    const savedFont = localStorage.getItem('fontSize') || 18;
    setFontSize(Number(savedFont));
    $('#fontInc').addEventListener('click', ()=> setFontSize(Math.min(28, parseInt(getComputedStyle(content).fontSize) + 2)));
    $('#fontDec').addEventListener('click', ()=> setFontSize(Math.max(12, parseInt(getComputedStyle(content).fontSize) - 2)));

    $('#lineHeightSelect').addEventListener('change', (e)=> { content.style.lineHeight = e.target.value; localStorage.setItem('lineHeight', e.target.value); });
    const savedLine = localStorage.getItem('lineHeight') || '1.85';
    $('#lineHeightSelect').value = savedLine; content.style.lineHeight = savedLine;

    /* ---------- Table of Contents auto-generate ---------- */
    function buildTOC(){
      const toc = $('#tocList'); toc.innerHTML = '';
      // If content has headings, use them
      const headings = content.querySelectorAll('h1,h2,h3');
      if(headings.length){
        headings.forEach(h=>{
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = '#' + (h.id || (h.id = 'id-' + Math.random().toString(36).slice(2,9)));
          a.textContent = h.textContent;
          a.addEventListener('click', (ev)=>{
            ev.preventDefault(); document.querySelector(a.getAttribute('href')).scrollIntoView({behavior:'smooth'});
          });
          li.appendChild(a); toc.appendChild(li);
        });
      } else {
        // fallback: use CHAPTERS list
        CHAPTERS.forEach((c,i)=>{
          const li = document.createElement('li');
          const a = document.createElement('a'); a.href = '#'; a.textContent = c.title;
          a.addEventListener('click', (ev)=>{ ev.preventDefault(); loadChapter(i); });
          li.appendChild(a); toc.appendChild(li);
        });
      }
    }

    /* ---------- Chapter loading & navigation ---------- */
    let currentChapterIndex = Number(localStorage.getItem('lastChapter') || 0);
    function renderChapterMeta(){
      const ch = CHAPTERS[currentChapterIndex];
      if(ch){
        $('#chapterTitle').textContent = ch.title;
        $('#chapterDate').textContent = ch.date || '';
        $('#chapterNumber').textContent = (currentChapterIndex+1) + '/' + CHAPTERS.length;
      }
    }

    async function loadChapter(index){
      if(!CHAPTERS[index]) return; currentChapterIndex = index; localStorage.setItem('lastChapter', index);
      renderChapterMeta();
      if(USE_EXTERNAL_CHAPTERS){
        try{
          const res = await fetch(CHAPTERS[index].file);
          if(!res.ok) throw new Error('Kh√¥ng th·ªÉ load ch∆∞∆°ng');
          const html = await res.text();
          // Expect the external file to contain only the inner HTML for #content OR a wrapper <article id="chapterContent"> ...</n          // Simple approach: extract body content
          const tmp = document.createElement('div'); tmp.innerHTML = html;
          const inner = tmp.querySelector('#content') || tmp.querySelector('article') || tmp;
          $('#content').innerHTML = inner.innerHTML;
          window.scrollTo({top:0,behavior:'auto'});
          buildTOC();
          window.dispatchEvent(new Event('resize'));
        }catch(err){
          console.error(err); $('#content').innerHTML = '<p>Kh√¥ng th·ªÉ t·∫£i ch∆∞∆°ng. Ki·ªÉm tra ƒë∆∞·ªùng d·∫´n ho·∫∑c b·∫≠t CORS n·∫øu c·∫ßn.</p>';
        }
      } else {
        // if chapters are embedded in this file, show/hide sections (not implemented in this template)
      }
    }

    // Prev/Next handlers
    function goNext(){ if(currentChapterIndex < CHAPTERS.length -1) loadChapter(currentChapterIndex +1); }
    function goPrev(){ if(currentChapterIndex > 0) loadChapter(currentChapterIndex -1); }
    $('#nextBtn').addEventListener('click', goNext); $('#nextBtnBottom').addEventListener('click', goNext);
    $('#prevBtn').addEventListener('click', goPrev); $('#prevBtnBottom').addEventListener('click', goPrev);

    /* ---------- Scroll progress and reading position ---------- */
    const progressEl = $('#siteProgress');
    const bubble = $('#bubble');
    function updateProgress(){
      const rect = content.getBoundingClientRect();
      const docHeight = content.scrollHeight - window.innerHeight + (rect.top * -1);
      const scrolled = Math.min(Math.max(window.scrollY - (content.offsetTop - 20), 0), content.scrollHeight);
      const percent = Math.round((window.scrollY - content.offsetTop + window.innerHeight/10) / (content.scrollHeight) * 100);
      const p = Math.min(100, Math.max(0, (window.scrollY - content.offsetTop + window.innerHeight/10) / (content.scrollHeight) * 100));
      progressEl.style.width = p + '%';
      bubble.textContent = Math.round(p) + '%';
      // show/hide back-to-top
      $('#backToTop').style.display = (window.scrollY > 400) ? 'block' : 'none';
      bubble.style.display = (window.scrollY > 120) ? 'block' : 'none';

      // Save reading position per-chapter
      const key = 'pos_ch_' + currentChapterIndex;
      localStorage.setItem(key, window.scrollY);
    }
    window.addEventListener('scroll', updateProgress);

    // restore reading position
    function restorePosition(){
      const key = 'pos_ch_' + currentChapterIndex; const pos = Number(localStorage.getItem(key) || 0);
      if(pos){ window.scrollTo({top: pos, behavior: 'auto'}); }
    }

    $('#backToTop').addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}));

    /* ---------- Bookmark & share ---------- */
    $('#bookmarkBtn').addEventListener('click', ()=>{
      const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
      const ch = CHAPTERS[currentChapterIndex]; if(!ch) return;
      if(!bookmarks.find(b=>b.file===ch.file)){ bookmarks.push({file:ch.file,title:ch.title,at:Date.now()}); localStorage.setItem('bookmarks', JSON.stringify(bookmarks)); alert('ƒê√£ ƒë√°nh d·∫•u ch∆∞∆°ng'); } else alert('ƒê√£ ƒë√°nh d·∫•u r·ªìi');
    });
    $('#shareBtn').addEventListener('click', ()=>{
      if(navigator.share){ navigator.share({title: document.title, text: CHAPTERS[currentChapterIndex].title, url: window.location.href}); }
      else{ navigator.clipboard.writeText(window.location.href).then(()=> alert('Link ƒë√£ copy')); }
    });

    /* ---------- small UI effects ---------- */
    window.addEventListener('load', ()=>{ setTimeout(()=>{ document.querySelectorAll('.fade').forEach(el=>el.classList.add('in')); },60); });

    /* ---------- TOC toggle for small screens ---------- */
    $('#tocToggle').addEventListener('click', ()=>{
      const card = $('#tocCard'); card.style.display = (card.style.display === 'none' ? 'block' : 'none');
    });

    /* ---------- Init ---------- */
    (async function init(){
      if(CHAPTERS.length){ renderChapterMeta(); await loadChapter(currentChapterIndex); restorePosition(); }
      buildTOC();
      // restore font size
      const f = localStorage.getItem('fontSize'); if(f) setFontSize(Number(f));
      updateProgress();
    })();

    /* ---------- Notes for maintainers ---------- */
    // - For external chapters (recommended), create files like chapters/chapter-1.html containing only the inner HTML of #content
    // - If hosting on GitHub Pages, ensure paths are correct and CORS is not an issue (same repo is fine).
    // - To enable Giscus/Utterances comments, uncomment the respective block and replace OWNER/REPO with your GitHub repo info.
    // - Accessibility: add proper aria-* attributes and tabindex if you want keyboard navigation.

  </script>
  <!-- Comment system per chapter using Giscus -->
  <script src="https://giscus.app/client.js"
        data-repo="namutachi-webtachi/MirAi-project-"
        data-repo-id="REPO_ID_HERE"
        data-category="General"
        data-category-id="CATEGORY_ID_HERE"
        data-mapping="pathname"
        data-strict="1"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="vi"
        crossorigin="anonymous"
        async>
  </script>
</body>
</html>

