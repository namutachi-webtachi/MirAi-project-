<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- [EDITABLE] Site title -->
  <title>[EDITABLE] Project-MirAi</title>
  <meta name="description" content="Template web truy·ªán: dark mode, TOC, navigation, reading progress, comments placeholder" />

  <!-- Basic styles -->
  <style>
    :root{
      --bg:#f7f7f7; --text:#111; --muted:#666; --accent:#7c3aed;
      --card:#fff; --shadow: 0 6px 18px rgba(18,18,18,0.06);
      --max-width:780px;
    }
    [data-theme="dark"]{
      --bg:#0b0b0d; --text:#e6e6e9; --muted:#9aa0a6;
      --card:#0f1113; --accent:#8b5cf6; --shadow: 0 8px 30px rgba(0,0,0,0.6);
    }

    html,body{height:100%;}
    body{
      margin:0;
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Header */
    header{
      position:sticky;
      top:0;
      z-index:40;
      background:linear-gradient(180deg, rgba(255,255,255,0.6), transparent);
      backdrop-filter: blur(6px);
      border-bottom:1px solid rgba(0,0,0,0.04);
    }
    [data-theme="dark"] header{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
      border-bottom:1px solid rgba(255,255,255,0.03);
    }

    .container{
      max-width:1200px;
      margin:0 auto;
      padding:18px;
      display:grid;
      grid-template-columns:1fr 320px;
      gap:28px;
      align-items:start;
    }
    main{max-width:var(--max-width);margin:0 auto;background:transparent}
    .card{background:var(--card);box-shadow:var(--shadow);border-radius:12px;padding:22px}

    .title{font-size:22px;font-weight:700;margin:6px 0}
    .meta{color:var(--muted);font-size:13px;margin-bottom:12px}

    /* controls & buttons */
    .controls{display:flex;gap:8px;align-items:center;margin-bottom:14px}
    .btn{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:8px 10px;border-radius:8px;cursor:pointer}
    [data-theme="dark"] .btn{border:1px solid rgba(255,255,255,0.04)}

    .content{line-height:1.85;font-size:18px;color:var(--text)}
    .content p{margin:12px 0}

    /* progress bar */
    .progress-wrap{height:6px;background:rgba(0,0,0,0.06);border-radius:999px;overflow:hidden;margin-top:6px}
    .progress{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#3b82f6)}

    /* Sidebar */
    aside{position:relative}
    .toc{position:sticky;top:88px}
    .toc h3{margin:0 0 10px 0}
    .toc ul{list-style:none;padding:0;margin:0}
    .toc li{margin:8px 0}
    .toc a{color:var(--text);text-decoration:none}

    /* footer actions */
    .nav-row{display:flex;justify-content:space-between;margin-top:18px}

    /* small screens */
    @media (max-width:900px){
      .container{grid-template-columns:1fr}
      aside{order:2}
      header{position:static}
    }

    .fade{opacity:0;transform:translateY(6px);transition:all .45s cubic-bezier(.2,.9,.3,1)}
    .fade.in{opacity:1;transform:none}

    .back-to-top{position:fixed;right:18px;bottom:18px;padding:10px;border-radius:10px;box-shadow:var(--shadow);background:var(--card);cursor:pointer}
    .reading-progress-bubble{position:fixed;left:18px;bottom:18px;padding:8px 10px;border-radius:999px;background:var(--card);box-shadow:var(--shadow);font-weight:600}

    @media (max-width:520px){
      .container{padding:10px}
      .card{padding:14px}
    }
  </style>
</head>
<body>
  <!-- ================= HEADER ================= -->
  <header class="card" style="margin:12px auto 16px;max-width:1200px;">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
      <div>
        <!-- [EDITABLE] Title & Author -->
        <div class="title">[EDITABLE] MirAi - Light Novel</div>
        <div class="meta">T√°c gi·∫£: <strong>[EDITABLE] NamuTachi</strong></div>
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        <button id="toggleTheme" class="btn" title="Chuy·ªÉn giao di·ªán">üåô</button>

        <div style="display:flex;align-items:center;gap:8px">
          <button id="fontDec" class="btn">A-</button>
          <button id="fontInc" class="btn">A+</button>
        </div>

        <button id="tocToggle" class="btn">üìö M·ª•c l·ª•c</button>
      </div>
    </div>

    <div class="progress-wrap" style="margin-top:12px">
      <div id="siteProgress" class="progress"></div>
    </div>
  </header>

  <!-- ================= LAYOUT ================= -->
  <div class="container">
    <main>
      <article id="chapter" class="card fade">
        <div id="chapterHeader">
          <!-- [EDITABLE] Chapter title will be overwritten by JS if CHAPTERS configured -->
          <h1 id="chapterTitle">Ch∆∞∆°ng 1</h1>
          <div class="meta">C·∫≠p nh·∫≠t: <span id="chapterDate">[EDITABLE] 2025-12-06</span></div>
        </div>

        <div class="controls">
          <div style="display:flex;align-items:center;gap:6px">
            <button id="prevBtn" class="btn">‚óÄ Tr∆∞·ªõc</button>
            <button id="nextBtn" class="btn">Sau ‚ñ∂</button>
          </div>

          <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
            <label style="font-size:13px;color:var(--muted)">Gi√£n d√≤ng</label>
            <select id="lineHeightSelect" class="btn">
              <option value="1.4">1.4</option>
              <option value="1.6">1.6</option>
              <option value="1.85" selected>1.85 (m·∫∑c ƒë·ªãnh)</option>
              <option value="2.2">2.2</option>
            </select>
          </div>
        </div>

        <!-- [EDITABLE] Content: if USE_EXTERNAL_CHAPTERS=false, paste HTML here -->
        <div id="content" class="content">
          <p>Minh m·ªâm c∆∞·ªùi, √°nh s√°ng chi·ªÅu cu·ªëi ng√†y tr√†n qua khung c·ª≠a s·ªï. ƒê√¢y l√† m·∫´u n·ªôi dung ch∆∞∆°ng, b·∫°n c√≥ th·ªÉ d√°n HTML ho·∫∑c markdown ƒë∆∞·ª£c chuy·ªÉn ƒë·ªïi sang HTML.</p>
          <h2 id="h-1">ƒêo·∫°n ph·ª•: K√Ω ·ª©c</h2>
          <p>ƒêo·∫°n m√¥ t·∫£, l·ªùi tho·∫°i, ...</p>
          <h2 id="h-2">ƒêo·∫°n ph·ª•: Cu·ªôc g·∫∑p</h2>
          <p>ƒêo·∫°n gi·ªõi thi·ªáu c·∫£nh g·∫∑p g·ª° gi·ªØa Minh v√† Vy ...</p>
        </div>

        <div class="nav-row">
          <div><button id="prevBtnBottom" class="btn">‚óÄ Ch∆∞∆°ng tr∆∞·ªõc</button></div>
          <div><button id="nextBtnBottom" class="btn">Ch∆∞∆°ng sau ‚ñ∂</button></div>
        </div>

        <!-- Comments placeholder: default commented. To enable, replace EDITABLE IDs below and uncomment -->
        <div style="margin-top:18px">
          <!-- Giscus: uncomment & fill IDs to enable -->
          <!--
          <div id="giscus" class="card" style="padding:12px">
            <script src="https://giscus.app/client.js"
              data-repo="[EDITABLE] namutachi-webtachi/MirAi-project-"
              data-repo-id="[EDITABLE_REPO_ID]"
              data-category="[EDITABLE] General"
              data-category-id="[EDITABLE_CATEGORY_ID]"
              data-mapping="pathname"
              data-reactions-enabled="1"
              data-emit-metadata="0"
              data-theme="light"
              crossorigin="anonymous"
              async>
            </script>
          </div>
          -->
        </div>

      </article>
    </main>

    <aside>
      <div class="card toc" id="tocCard">
        <h3>M·ª•c l·ª•c</h3>
        <ul id="tocList"></ul>
        <hr style="margin:12px 0;border:none;border-top:1px dashed rgba(0,0,0,0.06)" />
        <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
          <small style="color:var(--muted)">Ch∆∞∆°ng</small>
          <small style="color:var(--muted)" id="chapterNumber">0/0</small>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
          <button id="shareBtn" class="btn">Chia s·∫ª</button>
          <button id="bookmarkBtn" class="btn">ƒê√°nh d·∫•u</button>
        </div>
      </div>

      <div class="card" style="margin-top:14px">
        <h4 style="margin:0 0 8px 0">C√†i ƒë·∫∑t nhanh</h4>
        <div style="display:flex;gap:8px;align-items:center">
          <label style="font-size:13px;color:var(--muted)">Ch·∫ø ƒë·ªô</label>
          <button id="themeMini" class="btn">üåó</button>
        </div>
      </div>

    </aside>
  </div>

  <div class="back-to-top" id="backToTop" title="L√™n ƒë·∫ßu trang" style="display:none">‚Üë</div>
  <div class="reading-progress-bubble" id="bubble" style="display:none">0%</div>

  <!-- ================= SCRIPT ================= -->
  <script>
    /*
      IMPORTANT: All editable places are marked with [EDITABLE] comments in HTML above.
      - Replace CHAPTERS array below to point to your chapter files (if using external files)
      - If you prefer single-file chapters, set USE_EXTERNAL_CHAPTERS = false and paste inner HTML into #content
    */

    /* ---------- Configuration (EDITABLE) ---------- */
    const CHAPTERS = [
      // Example:
      // { title: "Ch∆∞∆°ng 1 ‚Äî Ti√™u ƒë·ªÅ", file: "/main-story/chapters/chapter-1.html", date: "2025-12-06" },
    ];
    const USE_EXTERNAL_CHAPTERS = true;

    /* ---------- Helpers ---------- */
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    /* ---------- Theme (dark/light) ---------- */
    function applyTheme(theme){
      document.documentElement.setAttribute('data-theme', theme);
      try { localStorage.setItem('theme', theme); } catch(e){}
      const tbtn = $('#toggleTheme');
      if (tbtn) tbtn.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    }
    const savedTheme = (function(){
      try { return localStorage.getItem('theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme:dark)').matches ? 'dark' : 'light'); }
      catch(e){ return (window.matchMedia && window.matchMedia('(prefers-color-scheme:dark)').matches ? 'dark' : 'light'); }
    })();
    applyTheme(savedTheme);

    const toggleThemeEl = $('#toggleTheme');
    if (toggleThemeEl) toggleThemeEl.addEventListener('click', ()=> applyTheme(document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'));
    const themeMiniEl = $('#themeMini'); if (themeMiniEl) themeMiniEl.addEventListener('click', ()=> { if (toggleThemeEl) toggleThemeEl.click(); });

    /* ---------- Font controls ---------- */
    const content = $('#content');
    function setFontSize(size){ if(content){ content.style.fontSize = size + 'px'; try{ localStorage.setItem('fontSize', size); }catch(e){} } }
    try { const savedFont = Number(localStorage.getItem('fontSize')) || 18; setFontSize(savedFont); } catch(e) { setFontSize(18); }
    const fontIncEl = $('#fontInc'); if (fontIncEl) fontIncEl.addEventListener('click', ()=> { if(content) setFontSize(Math.min(28, parseInt(getComputedStyle(content).fontSize) + 2)); });
    const fontDecEl = $('#fontDec'); if (fontDecEl) fontDecEl.addEventListener('click', ()=> { if(content) setFontSize(Math.max(12, parseInt(getComputedStyle(content).fontSize) - 2)); });

    const lineSelect = $('#lineHeightSelect');
    if (lineSelect && content) {
      lineSelect.addEventListener('change', (e)=> { content.style.lineHeight = e.target.value; try{ localStorage.setItem('lineHeight', e.target.value);}catch(e){} });
      try { const savedLine = localStorage.getItem('lineHeight') || '1.85'; lineSelect.value = savedLine; content.style.lineHeight = savedLine; } catch(e){ lineSelect.value='1.85'; content.style.lineHeight='1.85'; }
    }

    /* ---------- Table of Contents auto-generate ---------- */
    function buildTOC(){
      const toc = $('#tocList'); if(!toc || !content) return; toc.innerHTML = '';
      const headings = content.querySelectorAll('h1,h2,h3');
      if(headings.length){
        headings.forEach(h=>{
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = '#' + (h.id || (h.id = 'id-' + Math.random().toString(36).slice(2,9)));
          a.textContent = h.textContent;
          a.addEventListener('click', (ev)=>{
            ev.preventDefault();
            const target = document.querySelector(a.getAttribute('href'));
            if (target) target.scrollIntoView({behavior:'smooth'});
          });
          li.appendChild(a); toc.appendChild(li);
        });
      } else {
        // fallback: use CHAPTERS list
        CHAPTERS.forEach((c,i)=>{
          const li = document.createElement('li');
          const a = document.createElement('a'); a.href = '#'; a.textContent = c.title;
          a.addEventListener('click', (ev)=>{ ev.preventDefault(); loadChapter(i); });
          li.appendChild(a); toc.appendChild(li);
        });
      }
    }

    /* ---------- Chapter loading & navigation ---------- */
    let currentChapterIndex = Number(localStorage.getItem('lastChapter') || 0);
    function renderChapterMeta(){
      const ch = CHAPTERS[currentChapterIndex];
      if(ch){
        const titleEl = $('#chapterTitle'); const dateEl = $('#chapterDate'); const numEl = $('#chapterNumber');
        if(titleEl) titleEl.textContent = ch.title;
        if(dateEl) dateEl.textContent = ch.date || '';
        if(numEl) numEl.textContent = (currentChapterIndex+1) + '/' + CHAPTERS.length;
      } else {
        // when no CHAPTERS configured, keep static title/date
        const numEl = $('#chapterNumber'); if(numEl) numEl.textContent = '‚Äî';
      }
    }

    async function loadChapter(index){
      if(!CHAPTERS[index]) return;
      currentChapterIndex = index; try{ localStorage.setItem('lastChapter', index); }catch(e){}
      renderChapterMeta();
      if(USE_EXTERNAL_CHAPTERS){
        try{
          const res = await fetch(CHAPTERS[index].file);
          if(!res.ok) throw new Error('Kh√¥ng th·ªÉ load ch∆∞∆°ng');
          const html = await res.text();
          const tmp = document.createElement('div'); tmp.innerHTML = html;
          const inner = tmp.querySelector('#content') || tmp.querySelector('article') || tmp;
          if (inner && $('#content')) $('#content').innerHTML = inner.innerHTML;
          window.scrollTo({top:0,behavior:'auto'});
          buildTOC();
          window.dispatchEvent(new Event('resize'));
        }catch(err){
          console.error(err);
          if ($('#content')) $('#content').innerHTML = '<p>Kh√¥ng th·ªÉ t·∫£i ch∆∞∆°ng. Ki·ªÉm tra ƒë∆∞·ªùng d·∫´n ho·∫∑c b·∫≠t CORS n·∫øu c·∫ßn.</p>';
        }
      }
    }

    function goNext(){ if(currentChapterIndex < CHAPTERS.length -1) loadChapter(currentChapterIndex +1); }
    function goPrev(){ if(currentChapterIndex > 0) loadChapter(currentChapterIndex -1); }
    const nextBtn = $('#nextBtn'); if(nextBtn) nextBtn.addEventListener('click', goNext);
    const nextBtnBottom = $('#nextBtnBottom'); if(nextBtnBottom) nextBtnBottom.addEventListener('click', goNext);
    const prevBtn = $('#prevBtn'); if(prevBtn) prevBtn.addEventListener('click', goPrev);
    const prevBtnBottom = $('#prevBtnBottom'); if(prevBtnBottom) prevBtnBottom.addEventListener('click', goPrev);

    /* ---------- Scroll progress and reading position ---------- */
    const progressEl = $('#siteProgress');
    const bubble = $('#bubble');
    function updateProgress(){
      if(!content) return;
      const p = Math.min(100, Math.max(0, (window.scrollY - content.offsetTop + window.innerHeight/10) / (content.scrollHeight) * 100));
      if (progressEl) progressEl.style.width = p + '%';
      if (bubble) bubble.textContent = Math.round(p) + '%';
      if ($('#backToTop')) $('#backToTop').style.display = (window.scrollY > 400) ? 'block' : 'none';
      if (bubble) bubble.style.display = (window.scrollY > 120) ? 'block' : 'none';
      // Save reading position per-chapter
      const key = 'pos_ch_' + currentChapterIndex;
      try { localStorage.setItem(key, window.scrollY); } catch(e) {}
    }
    window.addEventListener('scroll', updateProgress);

    function restorePosition(){
      try {
        const key = 'pos_ch_' + currentChapterIndex;
        const pos = Number(localStorage.getItem(key) || 0);
        if(pos) window.scrollTo({top: pos, behavior: 'auto'});
      } catch(e) {}
    }

    const backToTop = $('#backToTop'); if (backToTop) backToTop.addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}));

    /* ---------- Bookmark & share (safe) ---------- */
    const bookmarkBtn = $('#bookmarkBtn');
    if (bookmarkBtn) bookmarkBtn.addEventListener('click', ()=>{
      try {
        const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
        const ch = CHAPTERS[currentChapterIndex]; if(!ch) return;
        if(!bookmarks.find(b=>b.file===ch.file)){ bookmarks.push({file:ch.file,title:ch.title,at:Date.now()}); localStorage.setItem('bookmarks', JSON.stringify(bookmarks)); alert('ƒê√£ ƒë√°nh d·∫•u ch∆∞∆°ng'); } else alert('ƒê√£ ƒë√°nh d·∫•u r·ªìi');
      } catch(e){ alert('Kh√¥ng th·ªÉ l∆∞u ƒë√°nh d·∫•u (localStorage kh√¥ng kh·∫£ d·ª•ng).'); }
    });

    const shareBtn = $('#shareBtn');
    if (shareBtn) shareBtn.addEventListener('click', async ()=>{
      const title = document.title;
      const text = (CHAPTERS[currentChapterIndex] && CHAPTERS[currentChapterIndex].title) ? CHAPTERS[currentChapterIndex].title : '';
      const url = window.location.href;
      if (navigator.share) {
        try {
          await navigator.share({ title, text, url });
        } catch (err) {
          // fallback to clipboard
          try {
            await navigator.clipboard.writeText(url);
            alert('Chia s·∫ª kh√¥ng kh·∫£ d·ª•ng ‚Äî link ƒë√£ ƒë∆∞·ª£c copy v√†o clipboard.');
          } catch(e){
            prompt('H√£y copy link b·∫±ng tay:', url);
          }
        }
      } else {
        try {
          await navigator.clipboard.writeText(url); alert('Link ƒë√£ copy');
        } catch(e){ prompt('H√£y copy link b·∫±ng tay:', url); }
      }
    });

    /* ---------- small UI effects ---------- */
    window.addEventListener('load', ()=>{ setTimeout(()=>{ document.querySelectorAll('.fade').forEach(el=>el.classList.add('in')); },60); });

    /* ---------- TOC toggle for small screens ---------- */
    const tocToggle = $('#tocToggle');
    if (tocToggle) tocToggle.addEventListener('click', ()=>{
      const card = $('#tocCard'); if(!card) return;
      card.style.display = (card.style.display === 'none' ? 'block' : 'none');
    });

    /* ---------- Init ---------- */
    (async function init(){
      if(CHAPTERS.length){
        renderChapterMeta();
        try { await loadChapter(currentChapterIndex); } catch(_) {}
        restorePosition();
      }
      buildTOC();
      try { const f = localStorage.getItem('fontSize'); if(f) setFontSize(Number(f)); } catch(e) {}
      updateProgress();
    })();

  </script>

  <!-- ============== Giscus (comment) - Uncomment & set IDs when ready ==============
  <script src="https://giscus.app/client.js"
        data-repo="[EDITABLE] namutachi-webtachi/MirAi-project-"
        data-repo-id="[EDITABLE_REPO_ID]"
        data-category="[EDITABLE] General"
        data-category-id="[EDITABLE_CATEGORY_ID]"
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="light"
        data-lang="vi"
        crossorigin="anonymous"
        async>
  </script>
  ============================================================================== -->

</body>
</html>
