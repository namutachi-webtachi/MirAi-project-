<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Project-MirAi</title>
  <meta name="description" content="Đọc truyện Project-MirAi - MirAi & NamuTachi" />
  
  <!-- Font Google đẹp mượt -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#fdfdfd;
      --text:#000000;           /* Đen tuyền */
      --muted:#333333;
      --accent:#8b5cf6;
      --card:#ffffff;
      --shadow:0 8px 25px rgba(0,0,0,0.08);
      --border:rgba(0,0,0,0.08);
    }
    [data-theme="dark"]{
      --bg:#0a0a0a;
      --text:#ffffff;           /* Trắng tuyền */
      --muted:#bbbbbb;
      --accent:#b794f4;
      --card:#0f0f0f;
      --shadow:0 10px 35px rgba(0,0,0,0.7);
      --border:rgba(255,255,255,0.08);
    }

    *{margin:0;padding:0;box-sizing:border-box;}
    body{
      font-family:'Roboto','Segoe UI',system-ui,sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.85;
      font-size:18px;
      min-height:100vh;
      -webkit-font-smoothing:antialiased;
    }
    header{
      position:sticky;top:0;z-index:100;
      background:var(--card);
      border-bottom:1px solid var(--border);
      backdrop-filter:blur(12px);
    }
    .container{
      max-width:1260px;margin:0 auto;padding:16px;
      display:grid;grid-template-columns:1fr 340px;gap:36px;align-items:start;
    }
    main{max-width:860px;margin:0 auto;}
    .card{
      background:var(--card);
      border-radius:18px;
      padding:28px;
      box-shadow:var(--shadow);
      margin-bottom:28px;
    }
    .title{
      font-size:28px;font-weight:800;color:var(--accent);margin-bottom:6px;
    }
    .meta{font-size:15px;color:var(--muted);margin-bottom:20px;}
    .controls{
      display:flex;flex-wrap:wrap;gap:14px;margin:24px 0;
    }
    .btn{
      background:rgba(139,92,246,0.08);
      border:1px solid var(--border);
      color:var(--text);
      padding:11px 18px;border-radius:14px;
      cursor:pointer;font-weight:500;transition:.25s;
    }
    .btn:hover{transform:translateY(-3px);box-shadow:0 6px 16px rgba(139,92,246,0.25);}
    .content{
      color:var(--text) !important;
      font-size:18.5px;
    }
    .content p{
      margin:18px 0;
      color:var(--text) !important;
    }
    .content *{color:var(--text) !important;}
    .progress-wrap{
      height:7px;background:rgba(0,0,0,0.08);border-radius:8px;overflow:hidden;margin-top:14px;
    }
    [data-theme="dark"] .progress-wrap{background:rgba(255,255,255,0.08);}
    .progress{
      height:100%;width:0;background:linear-gradient(90deg,var(--accent),#a78bfa);transition:width .4s;
    }
    .toc{position:sticky;top:96px;}
    .toc h3{font-size:19px;margin-bottom:14px;}
    .toc ul{list-style:none;}
    .toc a{
      display:block;padding:9px 12px;border-radius:10px;color:var(--text);
      text-decoration:none;transition:.2s;border-radius:10px;
    }
    .toc a:hover{background:rgba(139,92,246,0.15);}
    .toc a.active{font-weight:700;background:rgba(139,92,246,0.2);}
    .nav-row{display:flex;justify-content:space-between;margin-top:50px;}
    #backToTop,#bubble{
      position:fixed;bottom:24px;padding:14px 18px;border-radius:50px;
      background:var(--card);box-shadow:var(--shadow);cursor:pointer;
      font-weight:700;font-size:15px;display:none;z-index:999;
    }
    #backToTop{right:24px;}
    #bubble{left:24px;background:var(--accent);color:white !important;}

    @media(max-width:960px){
      .container{grid-template-columns:1fr;padding:12px;}
      .toc{position:static;margin-top:32px;}
      #tocCard{display:none;}
    }
  </style>
</head>
<body>

  <header class="card" style="margin:12px auto;max-width:1260px;">
    <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px;">
      <div>
        <div class="title">Project-MirAi</div>
        <div class="meta">Tác giả: NamuTachi / <strong>MirAi</strong></div>
      </div>
      <div style="display:flex;gap:12px;flex-wrap:wrap;">
        <button id="toggleTheme" class="btn">Dark</button>
        <button id="fontDec" class="btn">A-</button>
        <button id="fontInc" class="btn">A+</button>
        <button id="tocToggle" class="btn">Mục lục</button>
      </div>
    </div>
    <div class="progress-wrap"><div id="siteProgress" class="progress"></div></div>
  </header>

  <div class="container">
    <main>
      <article class="card">
        <h1 id="chapterTitle" style="font-size:29px;margin-bottom:10px;color:var(--accent);">Đang tải...</h1>
        <div class="meta">
          <span id="chapterNumber"></span> • Cập nhật: <span id="chapterDate"></span>
        </div>

        <div class="controls">
          <button id="prevBtn" class="btn">◀ Trước</button>
          <button id="bookmarkBtn" class="btn">Bookmark</button>
          <button id="shareBtn" class="btn">Share</button>
          <button id="nextBtn" class="btn">Sau ▶</button>
        </div>

        <div id="content" class="content">
          <!-- Nội dung chương sẽ được load vào đây -->
        </div>

        <div class="nav-row">
          <button id="prevBtnBottom" class="btn">◀ Trước</button>
          <button id="nextBtnBottom" class="btn">Sau ▶</button>
        </div>
      </article>

      <div id="backToTop">Top</div>
      <div id="bubble">0%</div>
    </main>

    <aside>
      <div id="tocCard" class="card toc">
        <h3>Mục lục</h3>
        <ul id="tocList"></ul>
      </div>
    </aside>
  </div>

<script>
// === DANH SÁCH CHƯƠNG - thêm thoải mái ===
const CHAPTERS = [
  {title:"Chương 1", file:"chapters/chuong-1.html", date:"2025-12-06"},
  {title:"Chương 2", file:"chapters/chuong-2.html", date:"2025-12-10"},
  {title:"Chương 3", file:"chapters/chuong-3.html", date:"2025-12-15"},
  // cứ thêm tiếp...
];

const USE_EXTERNAL_CHAPTERS = true;
const $ = s => document.querySelector(s);

let currentChapterIndex = parseInt(localStorage.getItem('lastChapter') || '0');

// Theme
const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
document.documentElement.setAttribute('data-theme', savedTheme);
$('#toggleTheme').textContent = savedTheme === 'dark' ? 'Light' : 'Dark';
$('#toggleTheme').onclick = () => {
  const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
  const newTheme = isDark ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme);
  $('#toggleTheme').textContent = newTheme === 'dark' ? 'Light' : 'Dark';
};

// Font size
let fontSize = parseInt(localStorage.getItem('fontSize') || '18.5');
$('#content').style.fontSize = fontSize + 'px';
$('#fontInc').onclick = () => { fontSize+=2; $('#content').style.fontSize = fontSize+'px'; localStorage.setItem('fontSize',fontSize); };
$('#fontDec').onclick = () => { fontSize-=2; if(fontSize<12) fontSize=12; $('#content').style.fontSize = fontSize+'px'; localStorage.setItem('fontSize',fontSize); };

// TOC
function buildTOC(){
  const list = $('#tocList'); list.innerHTML = '';
  CHAPTERS.forEach((ch,i)=>{
    const li = document.createElement('li');
    const a = document.createElement('a');
    a.href='#'; a.textContent = ch.title;
    a.onclick = e => {e.preventDefault(); loadChapter(i);};
    if(i===currentChapterIndex) a.classList.add('active');
    li.appendChild(a); list.appendChild(li);
  });
}

// Load chương
async function loadChapter(idx){
  if(!CHAPTERS[idx]) return;
  currentChapterIndex = idx;
  localStorage.setItem('lastChapter', idx);

  const ch = CHAPTERS[idx];
  $('#chapterTitle').textContent = ch.title;
  $('#chapterDate').textContent = ch.date;
  $('#chapterNumber').textContent = `${idx+1}/${CHAPTERS.length}`;

  if(USE_EXTERNAL_CHAPTERS){
    try{
      const res = await fetch(ch.file + '?v=' + Date.now());
      const html = await res.text();
      const tmp = document.createElement('div'); tmp.innerHTML = html;
      const inner = tmp.querySelector('#content') || tmp.querySelector('body') || tmp;
      $('#content').innerHTML = inner.innerHTML;
    }catch{
      $('#content').innerHTML = `<p style="text-align:center;color:red;">Không tải được chương<br><b>${ch.file}</b></p>`;
    }
  }
  window.scrollTo(0,0);
  buildTOC();
  restorePosition();
  updateProgress();
}

function goPrev(){ if(currentChapterIndex>0) loadChapter(currentChapterIndex-1); }
function goNext(){ if(currentChapterIndex<CHAPTERS.length-1) loadChapter(currentChapterIndex+1); }

['prevBtn','prevBtnBottom'].forEach(id=>$(`#${id}`).onclick=goPrev);
['nextBtn','nextBtnBottom'].forEach(id=>$(`#${id}`).onclick=goNext);

// Progress & vị trí đọc
function updateProgress(){
  const h = document.documentElement.scrollHeight - window.innerHeight;
  const s = window.scrollY;
  const p = h>0 ? Math.round((s/h)*100) : 0;
  $('#siteProgress').style.width = p + '%';
  $('#bubble').textContent = p + '%';
  $('#bubble').style.display = s>200 ? 'block' : 'none';
  $('#backToTop').style.display = s>600 ? 'block' : 'none';
  localStorage.setItem('pos_'+currentChapterIndex, s);
}
window.addEventListener('scroll', updateProgress);
function restorePosition(){
  const pos = localStorage.getItem('pos_'+currentChapterIndex);
  if(pos) window.scrollTo(0, parseInt(pos));
}
$('#backToTop').onclick = () => window.scrollTo({top:0,behavior:'smooth'});

// Bookmark & Share
$('#bookmarkBtn').onclick = () => {
  let b = JSON.parse(localStorage.getItem('bm')||'[]');
  const key = CHAPTERS[currentChapterIndex].file;
  if(!b.includes(key)){ b.push(key); localStorage.setItem('bm',JSON.stringify(b)); alert('Đã bookmark'); }
  else alert('Đã bookmark rồi');
};
$('#shareBtn').onclick = () => {
  if(navigator.share) navigator.share({title:CHAPTERS[currentChapterIndex].title,url:location.href});
  else{ navigator.clipboard.writeText(location.href); alert('Đã copy link'); }
};

// Mobile TOC
$('#tocToggle').onclick = () => {
  const toc = $('#tocCard');
  toc.style.display = toc.style.display==='block' ? 'none' : 'block';
};

// Khởi động
loadChapter(currentChapterIndex);
buildTOC();
updateProgress();

</script>
</body>
</html>
