<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Project-MirAi</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- Facebook SDK -->
  <div id="fb-root"></div>
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v20.0&appId=123456789&autoLogAppEvents=1"></script>

  <style>
    :root{--bg:#ffffff;--text:#000000;--card:#ffffff;--accent:#a855f7;--border:rgba(0,0,0,0.09);--shadow:0 10px 40px rgba(0,0,0,0.08);}
    [data-theme="dark"]{--bg:#0b0b0e;--text:#ffffff;--card:#111114;--accent:#c084fc;--border:rgba(255,255,255,0.08);--shadow:0 12px 50px rgba(0,0,0,0.6);}

    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Roboto',sans-serif;background:var(--bg);color:var(--text);line-height:1.9;font-size:18px;padding-bottom:140px;transition:all .3s;}

    header{position:sticky;top:0;z-index:100;background:var(--card);border-bottom:1px solid var(--border);backdrop-filter:blur(15px);padding:18px 0;}
    .header-inner{max-width:1100px;margin:0 auto;padding:0 20px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px;}
    .title{font-size:29px;font-weight:800;background:linear-gradient(135deg,#a855f7,#e0a3ff);background-clip:text;-webkit-background-clip:text;color:transparent;}
    .meta{font-size:15px;color:#888;margin-top:5px;}

    .controls{display:flex;gap:13px;flex-wrap:wrap;}
    .btn{padding:11px 24px;border-radius:50px;background:rgba(168,85,247,0.12);border:none;color:var(--text);font-weight:500;cursor:pointer;transition:.3s;}
    .btn:hover{background:var(--accent);color:white;transform:translateY(-3px);box-shadow:0 8px 25px rgba(168,85,247,0.3);}

    .container{max-width:900px;margin:30px auto 0;padding:0 20px;}
    .chapter-card{background:var(--card);border-radius:24px;padding:38px 35px;box-shadow:var(--shadow);position:relative;}

    #chapterTitle{font-size:32px;text-align:center;color:var(--accent);margin-bottom:14px;font-weight:700;}
    .chapter-meta{text-align:center;color:#999;margin-bottom:40px;font-size:16.5px;}
    .chapter-meta span{font-weight:600;color:var(--accent);}

    .nav-btns{display:flex;justify-content:center;gap:20px;margin:40px 0 50px;flex-wrap:wrap;}
    .nav-btns .btn{min-width:150px;font-size:16px;}

    #content{min-height:65vh;}
    #content p{margin:24px 0;text-align:justify;font-size:18.5px;}
    #content *{color:var(--text)!important;}

    .progress-bar{height:7px;background:#f0e6ff;border-radius:4px;overflow:hidden;margin:30px 0;}
    [data-theme="dark"] .progress-bar{background:#1a1a1f;}
    .progress{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#e0a3ff);transition:width .5s ease;}

    /* Reaction si√™u ƒë·∫πp */
    .reactions{margin:50px 0;text-align:center;}
    .reactions span{font-size:28px;cursor:pointer;margin:0 12px;transition:.3s;user-select:none;}
    .reactions span:hover{transform:scale(1.35) translateY(-5px);}
    .reactions div{margin-top:12px;font-size:15px;color:#888;}

    /* L∆∞·ª£t ƒë·ªçc */
    .views{display:block;text-align:center;margin:20px 0 40px;color:#aaa;font-size:15px;}
    .views strong{color:var(--accent);font-size:18px;}

    /* Social float */
    .social-float{position:fixed;right:26px;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:20px;z-index:998;}
    .social-float a{width:58px;height:58px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:25px;box-shadow:0 10px 30px rgba(0,0,0,0.3);transition:.3s;}
    .social-float a:hover{transform:scale(1.18) translateY(-6px);}
    .fb-bg{background:#1877f2;}
    .dc-bg{background:#5865f2;}
    .donate-bg{background:#ff3040;}

    @media(max-width:868px){
      .social-float{flex-direction:row;bottom:24px;top:auto;left:50%;right:auto;transform:translateX(-50%);gap:26px;}
      .chapter-card{padding:30px 22px;}
      #chapterTitle{font-size:28px;}
      .reactions span{font-size:25px;margin:0 10px;}
    }
  </style>
</head>
<body>

<header>
  <div class="header-inner">
    <div>
      <div class="title">Project-MirAi</div>
      <div class="meta">T√°c gi·∫£: NamuTachi / <strong>MirAi</strong></div>
    </div>
    <div class="controls">
      <button id="toggleTheme" class="btn">Dark</button>
      <button id="fontDec" class="btn">A-</button>
      <button id="fontInc" class="btn">A+</button>
      <button id="tocBtn" class="btn">M·ª•c l·ª•c</button>
    </div>
  </div>
  <div style="max-width:1100px;margin:0 auto;padding:0 20px;">
    <div class="progress-bar"><div id="progress" class="progress"></div></div>
  </div>
</header>

<div class="container">
  <div class="chapter-card">
    <h1 id="chapterTitle">ƒêang t·∫£i...</h1>
    <div class="chapter-meta">
      <span id="chapterNumber"></span> ‚Ä¢ C·∫≠p nh·∫≠t: <span id="chapterDate"></span>
    </div>

    <div class="nav-btns">
      <button id="prevBtn" class="btn">‚óÄ Tr∆∞·ªõc</button>
      <button id="bookmarkBtn" class="btn">Bookmark</button>
      <button id="shareBtn" class="btn">Share</button>
      <button id="nextBtn" class="btn">Sau ‚ñ∂</button>
    </div>

    <div id="content"></div>

    <!-- L∆∞·ª£t ƒë·ªçc + Reaction -->
    <div class="views">ƒêang c√≥ <strong id="viewCount">0</strong> ng∆∞·ªùi ƒëang ƒë·ªçc ch∆∞∆°ng n√†y c√πng b·∫°n</div>

    <div class="reactions">
      <div style="margin-bottom:10px;font-weight:500;color:#aaa;">C·∫£m x√∫c c·ªßa b·∫°n sau ch∆∞∆°ng n√†y?</div>
      <span id="cry" data-emoji="üò≠">üò≠</span>
      <span id="shock" data-emoji="üò±">üò±</span>
      <span id="angry" data-emoji="ü§¨">ü§¨</span>
      <span id="love" data-emoji="ü•π">ü•π</span>
      <span id="broken" data-emoji="üíî">üíî</span>
      <span id="fire" data-emoji="üî•">üî•</span>
      <div style="margin-top:18px;" id="reactionResult"></div>
    </div>

    <!-- Facebook Comments - gi·ªù PC + Mobile ƒë·ªÅu hi·ªán ƒë·∫πp -->
    <div style="margin:60px 0 40px;border-top:2px solid #eee;padding-top:40px;">
      <div class="fb-comments" data-href="" data-width="100%" data-numposts="15" data-colorscheme="light" data-lazy="true" data-order-by="reverse_time"></div>
    </div>

    <div class="nav-btns">
      <button id="prevBtnBottom" class="btn">‚óÄ Tr∆∞·ªõc</button>
      <button id="nextBtnBottom" class="btn">Sau ‚ñ∂</button>
    </div>
  </div>
</div>

<!-- Social float -->
<div class="social-float">
  <a href="https://facebook.com/namutachi.mirai" target="_blank" class="fb-bg">f</a>
  <a href="https://discord.gg/abc123xyz" target="_blank" class="dc-bg">D</a>
  <a href="#" target="_blank" class="donate-bg">‚ô•</a>
</div>

<script>
const CHAPTERS = [
  {title:"Ch∆∞∆°ng 1", file:"chapters/chuong-1.html", date:"2025-12-06"},
  {title:"Ch∆∞∆°ng 2", file:"chapters/chuong-2.html", date:"2025-12-10"},
  {title:"Ch∆∞∆°ng 3", file:"chapters/chuong-3.html", date:"2025-12-15"},
];

let current = parseInt(localStorage.getItem('lastChapter') || '0');
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);

// Dark mode
if(localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)){
  document.documentElement.setAttribute('data-theme','dark');
}
$('#toggleTheme').textContent = document.documentElement.getAttribute('data-theme') === 'dark' ? 'Light' : 'Dark';
$('#toggleTheme').onclick = () => {
  const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
  document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
  localStorage.setItem('theme', isDark ? 'light' : 'dark');
  $('#toggleTheme').textContent = isDark ? 'Dark' : 'Light';
};

// Font size
let fsize = parseFloat(localStorage.getItem('fontSize') || '18.5');
$('#content').style.fontSize = fsize + 'px';
$('#fontInc').onclick = () => { fsize += 2; $('#content').style.fontSize = fsize+'px'; localStorage.setItem('fontSize', fsize); };
$('#fontDec').onclick = () => { fsize = Math.max(14, fsize-2); $('#content').style.fontSize = fsize+'px'; localStorage.setItem('fontSize', fsize); };

// Load ch∆∞∆°ng
async function load(){
  const ch = CHAPTERS[current];
  $('#chapterTitle').textContent = ch.title;
  $('#chapterDate').textContent = ch.date;
  $('#chapterNumber').textContent = `${current+1}/${CHAPTERS.length}`;

  try{
    const res = await fetch(ch.file + '?t=' + Date.now());
    $('#content').innerHTML = res.ok ? (await res.text()).match(/<body[^>]*>([\s\S]*)<\/body>/i)?.[1] || await res.text() : `<p style="text-align:center;color:#ff3366;font-size:19px;">404 - Kh√¥ng t√¨m th·∫•y ch∆∞∆°ng n√†y</p>`;
  }catch{
    $('#content').innerHTML = '<p style="text-align:center;color:#ff3366;">L·ªói t·∫£i ch∆∞∆°ng</p>';
  }

  document.querySelector('.fb-comments').setAttribute('data-href', location.href + '?chapter=' + (current+1));

  updateViews();
  loadReactions();
  buildTOC();
  restoreScroll();
}
load();

// L∆∞·ª£t ƒë·ªçc gi·∫£ l·∫≠p (tƒÉng d·∫ßn ƒë·∫πp m·∫Øt)
function updateViews(){
  let views = parseInt(localStorage.getItem('views_' + current) || Math.floor(Math.random()*120 + 380));
  views += Math.floor(Math.random()*7 + 1);
  localStorage.setItem('views_' + current, views);
  const el = $('#viewCount');
  let start = 0;
  const timer = setInterval(() => {
    start += Math.floor(Math.random()*19 + 8);
    if(start >= views){ el.textContent = views.toLocaleString('vi-VN'); clearInterval(timer); }
    else el.textContent = start.toLocaleString('vi-VN');
  }, 80);
}

// Reaction h·ªá th·ªëng
function loadReactions(){
  const key = 'react_' + current;
  const data = JSON.parse(localStorage.getItem(key) || '{}');
  const result = $('#reactionResult');
  if(Object.keys(data).length === 0){
    result.innerHTML = '<span style="color:#aaa;">Ch∆∞a c√≥ ai th·∫£ c·∫£m x√∫c...</span>';
  }else{
    let max = 0, emoji = '';
    for(let k in data){
      if(data[k] > max){ max = data[k]; emoji = k; }
    }
    result.innerHTML = `ƒêa s·ªë ƒëang c·∫£m th·∫•y ${emoji} <strong>${max}</strong> ng∆∞·ªùi`;
  }

  // G√°n s·ª± ki·ªán
  $$('.reactions span').forEach(span => {
    span.onclick = () => {
      const e = span.getAttribute('data-emoji');
      const newData = JSON.parse(localStorage.getItem(key) || '{}');
      newData[e] = (newData[e] || 0) + 1;
      localStorage.setItem(key, JSON.stringify(newData));
      span.style.transform = 'scale(1.6)';
      setTimeout(() => span.style.transform = '', 300);
      loadReactions();
    };
  });
}

// N√∫t Tr∆∞·ªõc Sau
function prev(){ if(current > 0){ current--; localStorage.setItem('lastChapter', current); load(); } }
function next(){ if(current < CHAPTERS.length-1){ current++; localStorage.setItem('lastChapter', current); load(); } }
$$('#prevBtn, #prevBtnBottom').forEach(b => b.onclick = prev);
$$('#nextBtn, #nextBtnBottom').forEach(b => b.onclick = next);

// TOC mobile
$('#tocBtn').onclick = () => {
  let html = '<div style="display:flex;flex-direction:column;gap:10px;">';
  CHAPTERS.forEach((ch,i) => {
    html += `<a href="#" style="padding:14px 20px;border-radius:14px;background:${i===current?'rgba(168,85,247,0.25)':'transparent'};font-weight:${i===current?'600':''}">${ch.title}</a>`;
  });
  html += '</div>';
  const overlay = document.createElement('div');
  overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:999;display:flex;align-items:center;justify-content:center;padding:20px;';
  overlay.innerHTML = `<div style="background:var(--card);width:100%;max-width:460px;border-radius:24px;padding:30px;max-height:90vh;overflow-y:auto;">
    <h3 style="text-align:center;color:var(--accent);margin-bottom:20px;font-size:25px;">M·ª•c l·ª•c</h3>${html}
    <div style="text-align:center;margin-top:30px;"><button class="btn" onclick="this.closest('div[style]').parentElement.remove()">ƒê√≥ng</button></div>
  </div>`;
  overlay.onclick = e => { if(e.target === overlay) overlay.remove(); };
  document.body.appendChild(overlay);
};

// Progress + scroll
const updateProgress = () => {
  const h = document.documentElement.scrollHeight - window.innerHeight;
  const s = window.scrollY;
  const p = h > 100 ? (s / h) * 100 : 0;
  $('#progress').style.width = p + '%';
  localStorage.setItem('scroll_' + current, s);
};
window.addEventListener('scroll', updateProgress);
const restoreScroll = () => { const pos = localStorage.getItem('scroll_' + current); if(pos) window.scrollTo(0, parseInt(pos)); };
document.getElementById('backToTop')?.addEventListener('click', () => window.scrollTo({top:0,behavior:'smooth'}));

updateProgress();
</script>
</body>
</html>
