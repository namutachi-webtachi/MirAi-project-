<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Project-MirAi</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#ffffff;
      --text:#000000;
      --card:#ffffff;
      --accent:#9366ff;
      --border:rgba(0,0,0,0.1);
      --shadow:0 8px 32px rgba(0,0,0,0.08);
    }
    [data-theme="dark"]{
      --bg:#0d0d0f;
      --text:#ffffff;
      --card:#111113;
      --accent:#b794f4;
      --border:rgba(255,255,255,0.08);
      --shadow:0 10px 40px rgba(0,0,0,0.6);
    }

    *{margin:0;padding:0;box-sizing:border-box;}
    body{
      font-family:'Roboto', system-ui, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.9;
      font-size:18px;
      padding-bottom:80px;
    }
    header{
      position:sticky;top:0;z-index:100;
      background:var(--card);
      border-bottom:1px solid var(--border);
      backdrop-filter:blur(12px);
      padding:16px 0;
    }
    .header-inner{
      max-width:1100px;margin:0 auto;padding:0 20px;
      display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;
    }
    .title{font-size:28px;font-weight:800;color:var(--accent);}
    .meta{font-size:15px;color:#555; margin-top:4px;}
    [data-theme="dark"] .meta{color:#aaa;}

    .controls{
      display:flex;gap:12px;flex-wrap:wrap;
    }
    .btn{
      padding:10px 18px;
      border-radius:50px;
      border:none;
      background:rgba(147,102,255,0.15);
      color:var(--text);
      font-weight:500;
      cursor:pointer;
      transition:.3s;
    }
    .btn:hover{background:var(--accent);color:white;}

    .container{
      max-width:900px;
      margin:0 auto;
      padding:20px;
    }
    .chapter-card{
      background:var(--card);
      border-radius:20px;
      padding:32px;
      box-shadow:var(--shadow);
      margin-top:20px;
    }
    #chapterTitle{
      font-size:30px;
      text-align:center;
      color:var(--accent);
      margin-bottom:12px;
    }
    .chapter-meta{
      text-align:center;
      color:#666;
      margin-bottom:30px;
      font-size:16px;
    }
    [data-theme="dark"] .chapter-meta{color:#aaa;}

    .nav-btns{
      display:flex;justify-content:center;gap:16px;margin:30px 0 40px;
      flex-wrap:wrap;
    }
    .nav-btns .btn{
      min-width:140px;
      display:flex;align-items:center;justify-content:center;gap:8px;
    }

    #content{
      min-height:60vh;
      color:var(--text) !important;
    }
    #content p{
      margin:20px 0;
      text-align:justify;
    }
    #content *{color:var(--text) !important;}

    .progress-bar{
      height:6px;background:#eee;border-radius:3px;overflow:hidden;margin:20px 0;}
    [data-theme="dark"] .progress-bar{background:#222;}
    .progress{height:100%;width:0;background:var(--accent);transition:width .4s;}

    /* Mobile TOC */
    #tocOverlay{
      position:fixed;top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.7);z-index:999;
      display:none;align-items:center;justify-content:center;
    }
    #tocBox{
      background:var(--card);
      width:90%;max-width:400px;max-height:80vh;
      border-radius:20px;padding:24px;
      box-shadow:0 20px 50px rgba(0,0,0,0.3);
      overflow-y:auto;
    }
    #tocBox h3{margin-bottom:16px;text-align:center;color:var(--accent);}
    #tocList a{
      display:block;padding:12px 16px;
      border-radius:12px;margin:6px 0;
      color:var(--text);
      text-decoration:none;
      transition:.2s;
    }
    #tocList a:hover, #tocList a.active{
      background:rgba(147,102,255,0.2);
      font-weight:600;
    }

    .floating{
      position:fixed;bottom:24px;z-index:99;
      padding:14px 20px;border-radius:50px;
      background:var(--accent);color:white;
      box-shadow:var(--shadow);font-weight:600;
      display:none;
    }
    #backToTop{right:24px;}
    #progressBubble{left:24px;}

    @media(max-width:768px){
      .container{padding:16px;}
      .chapter-card{padding:24px 20px;}
      #chapterTitle{font-size:26px;}
      .nav-btns .btn{min-width:120px;font-size:15px;padding:10px 14px;}
    }
  </style>
</head>
<body>

<header>
  <div class="header-inner">
    <div>
      <div class="title">Project-MirAi</div>
      <div class="meta">T√°c gi·∫£: NamuTachi / <strong>MirAi</strong></div>
    </div>
    <div class="controls">
      <button id="toggleTheme" class="btn">Dark Mode</button>
      <button id="fontDec" class="btn">A-</button>
      <button id="fontInc" class="btn">A+</button>
      <button id="tocBtn" class="btn">M·ª•c l·ª•c</button>
    </div>
  </div>
  <div style="max-width:1100px;margin:0 auto;padding:0 20px;">
    <div class="progress-bar"><div id="progress" class="progress"></div></div>
  </div>
</header>

<div class="container">
  <div class="chapter-card">
    <h1 id="chapterTitle">ƒêang t·∫£i...</h1>
    <div class="chapter-meta">
      <span id="chapterNumber"></span> ‚Ä¢ C·∫≠p nh·∫≠t: <span id="chapterDate"></span>
    </div>

    <div class="nav-btns">
      <button id="prevBtn" class="btn">Tr∆∞·ªõc</button>
      <button id="bookmarkBtn" class="btn">Bookmark</button>
      <button id="shareBtn" class="btn">Share</button>
      <button id="nextBtn" class="btn">Sau</button>
    </div>

    <div id="content">
      <p style="text-align:center;color:#999;margin-top:50px;">
        ƒêang t·∫£i ch∆∞∆°ng... N·∫øu th·∫•y 404, h√£y t·∫°o file trong th∆∞ m·ª•c <code>chapters/</code>
      </p>
    </div>

    <div class="nav-btns">
      <button id="prevBtnBottom" class="btn">Tr∆∞·ªõc</button>
      <button id="nextBtnBottom" class="btn">Sau</button>
    </div>
  </div>
</div>

<!-- N√∫t n·ªïi -->
<div id="backToTop" class="floating">Top</div>
<div id="progressBubble" class="floating">0%</div>

<!-- Overlay m·ª•c l·ª•c (mobile) -->
<div id="tocOverlay">
  <div id="tocBox">
    <h3>M·ª•c l·ª•c</h3>
    <div id="tocList"></div>
    <div style="text-align:center;margin-top:20px;">
      <button class="btn" onclick="document.getElementById('tocOverlay').style.display='none'">ƒê√≥ng</button>
    </div>
  </div>
</div>

<script>
const CHAPTERS = [
  {title:"Ch∆∞∆°ng 1", file:"chapters/chuong-1.html", date:"2025-12-06"},
  {title:"Ch∆∞∆°ng 2", file:"chapters/chuong-2.html", date:"2025-12-10"},
  {title:"Ch∆∞∆°ng 3", file:"chapters/chuong-3.html", date:"2025-12-15"},
  // th√™m ch∆∞∆°ng m·ªõi ·ªü ƒë√¢y
];

let current = parseInt(localStorage.getItem('lastChapter') || '0');
const $ = s => document.querySelector(s);

// Theme
const isDark = localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches);
if(isDark) document.documentElement.setAttribute('data-theme','dark');
$('#toggleTheme').textContent = isDark ? 'Light Mode' : 'Dark Mode';
$('#toggleTheme').onclick = () => {
  const newTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme);
  $('#toggleTheme').textContent = newTheme === 'dark' ? 'Light Mode' : 'Dark Mode';
};

// Font
let size = parseFloat(localStorage.getItem('fontSize') || '18');
$('#content').style.fontSize = size + 'px';
$('#fontInc').onclick = () => { size+=2; $('#content').style.fontSize=size+'px'; localStorage.setItem('fontSize',size); };
$('#fontDec').onclick = () => { size=Math.max(14,size-2); $('#content').style.fontSize=size+'px'; localStorage.setItem('fontSize',size); };

// Load ch∆∞∆°ng
async function load(){
  const ch = CHAPTERS[current];
  if(!ch){
    $('#content').innerHTML = '<p style="text-align:center;font-size:20px;color:#999;">Ch∆∞a c√≥ ch∆∞∆°ng n√†o c·∫£ üòÖ</p>';
    $('#chapterTitle').textContent = 'Project-MirAi';
    return;
  }
  $('#chapterTitle').textContent = ch.title;
  $('#chapterDate').textContent = ch.date;
  $('#chapterNumber').textContent = `${current+1}/${CHAPTERS.length}`;

  try{
    const res = await fetch(ch.file + '?v=' + Date.now());
    if(res.ok){
      const html = await res.text();
      const div = document.createElement('div');
      div.innerHTML = html;
      const content = div.querySelector('#content') || div.querySelector('body') || div;
      $('#content').innerHTML = content.innerHTML || '<p style="color:#666;text-align:center;">Ch∆∞a c√≥ n·ªôi dung ch∆∞∆°ng n√†y.</p>';
    }else{
      $('#content').innerHTML = `<p style="text-align:center;color:#ff5555;">404 - Kh√¥ng t√¨m th·∫•y file<br><b>${ch.file}</b></p>`;
    }
  }catch(e){
    $('#content').innerHTML = `<p style="text-align:center;color:#ff5555;">L·ªói t·∫£i ch∆∞∆°ng<br><small>${e.message}</small></p>`;
  }
  updateProgress();
  restoreScroll();
  buildTOC();
}
load();

// TOC
function buildTOC(){
  const list = $('#tocList');
  list.innerHTML = '';
  CHAPTERS.forEach((ch,i)=>{
    const a = document.createElement('a');
    a.href = '#';
    a.textContent = ch.title;
    if(i===current) a.classList.add('active');
    a.onclick = e=>{ e.preventDefault(); current=i; localStorage.setItem('lastChapter',i); load(); $('#tocOverlay').style.display='none'; };
    list.appendChild(a);
  });
}
$('#tocBtn').onclick = () => $('#tocOverlay').style.display='flex';
buildTOC();

// Navigation
function prev(){ if(current>0){ current--; localStorage.setItem('lastChapter',current); load(); }}
function next(){ if(current<CHAPTERS.length-1){ current++; localStorage.setItem('lastChapter',current); load(); }}
$('#prevBtn,#prevBtnBottom').forEach(b=>b.onclick=prev);
$('#nextBtn,#nextBtnBottom').forEach(b=>b.onclick=next);

// Progress
function updateProgress(){
  const h = document.documentElement.scrollHeight - window.innerHeight;
  const s = window.scrollY;
  p = h>0 ? Math.round(s/h*100) : 0;
  $('#progress').style.width = p + '%';
  $('#progressBubble').textContent = p + '%';
  $('#progressBubble').style.display = s>300 ? 'block' : 'none';
  $('#backToTop').style.display = s>600 ? 'block' : 'none';
  localStorage.setItem('scroll_'+current, s);
}
window.addEventListener('scroll', updateProgress);
function restoreScroll(){
  const saved = localStorage.getItem('scroll_'+current);
  if(saved) window.scrollTo(0, parseInt(saved));
}
$('#backToTop').onclick = () => window.scrollTo({top:0,behavior:'smooth'});

// Bookmark & Share
$('#bookmarkBtn').onclick = () => {
  let b = JSON.parse(localStorage.getItem('bm')||'[]');
  const k = CHAPTERS[current].file;
  if(!b.includes(k)){ b.push(k); localStorage.setItem('bm',JSON.stringify(b)); alert('ƒê√£ bookmark'); }
  else alert('ƒê√£ bookmark r·ªìi nha');
};
$('#shareBtn').onclick = () => {
  navigator.clipboard?.writeText(location.href) || alert('ƒê√£ copy link');
  alert('ƒê√£ copy link ch∆∞∆°ng');
};
</script>
</body>
</html>
