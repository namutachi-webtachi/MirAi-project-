<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Project-MirAi</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- Facebook SDK -->
  <div id="fb-root"></div>
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v20.0"></script>

  <style>
    :root{--bg:#fdfdfd;--text:#000000;--card:#ffffff;--accent:#000000;--border:rgba(0,0,0,0.08);--shadow:0 10px 40px rgba(0,0,0,0.07);}
    [data-theme="dark"]{--bg:#0a0a0a;--text:#ffffff;--card:#0f0f0f;--accent:#ffffff;--border:rgba(255,255,255,0.08);--shadow:0 12px 50px rgba(0,0,0,0.7);}

    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Roboto',sans-serif;background:var(--bg);color:var(--text);line-height:1.9;font-size:18px;padding-bottom:120px;transition:background .4s,color .4s;}

    header{position:sticky;top:0;z-index:100;background:var(--card);border-bottom:1px solid var(--border);backdrop-filter:blur(15px);padding:18px 0;}
    .header-inner{max-width:1100px;margin:0 auto;padding:0 20px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px;}
    .title{font-size:29px;font-weight:800;color:var(--text);}
    .meta{font-size:15px;color:#888;margin-top:5px;}
    [data-theme="dark"] .meta{color:#999;}

    .controls{display:flex;gap:13px;flex-wrap:wrap;}
    .btn{padding:11px 24px;border-radius:50px;background:rgba(0,0,0,0.07);border:1px solid var(--border);color:var(--text);font-weight:500;cursor:pointer;transition:.3s;}
    .btn:hover{background:var(--accent);color:var(--bg);transform:translateY(-3px);box-shadow:0 8px 25px rgba(0,0,0,0.25);}
    [data-theme="dark"] .btn{background:rgba(255,255,255,0.07);}
    [data-theme="dark"] .btn:hover{background:var(--accent);color:#000;}

    .container{max-width:900px;margin:30px auto 0;padding:0 20px;}
    .chapter-card{background:var(--card);border-radius:24px;padding:40px 36px;box-shadow:var(--shadow);}

    #chapterTitle{font-size:32px;text-align:center;color:var(--text);margin-bottom:14px;font-weight:700;opacity:0.95;}
    .chapter-meta{text-align:center;color:#888;margin-bottom:45px;font-size:16.5px;}
    .chapter-meta span{font-weight:600;color:var(--text);opacity:0.9;}

    .nav-btns{display:flex;justify-content:center;gap:20px;margin:40px 0 50px;flex-wrap:wrap;}
    .nav-btns .btn{min-width:150px;font-size:16px;}

    #content{min-height:65vh;}
    #content p{margin:25px 0;text-align:justify;font-size:18.5px;}
    #content *{color:var(--text)!important;}

    .progress-bar{height:6px;background:rgba(0,0,0,0.08);border-radius:4px;overflow:hidden;margin:30px 0;}
    [data-theme="dark"] .progress-bar{background:rgba(255,255,255,0.08);}
    .progress{height:100%;width:0;background:var(--accent);transition:width .5s ease;}

    /* Reaction - ƒëen tr·∫Øng thanh l·ªãch */
    .reactions{margin:60px 0 50px;text-align:center;}
    .reactions > div:first-child{margin-bottom:16px;font-weight:500;color:#888;font-size:16px;}
    .reactions span{font-size:30px;cursor:pointer;margin:0 16px;transition:.3s;user-select:none;opacity:0.85;}
    .reactions span:hover{transform:scale(1.45) translateY(-6px);opacity:1;}
    #reactionResult{margin-top:20px;font-size:16px;color:#888;}

    /* Social float - gi·ªØ m√†u g·ªëc cho d·ªÖ nh·∫≠n di·ªán, nh∆∞ng l√†m t·ªëi h∆°n m·ªôt ch√∫t cho thanh l·ªãch */
    .social-float{position:fixed;right:26px;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:20px;z-index:998;}
    .social-float a{width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:24px;box-shadow:0 10px 30px rgba(0,0,0,0.35);transition:.3s;}
    .social-float a:hover{transform:scale(1.18) translateY(-6px);}
    .fb-bg{background:#1877f2;}
    .dc-bg{background:#5865f2;}
    .donate-bg{background:#000000;}

    @media(max-width:868px){
      .social-float{flex-direction:row;bottom:24px;top:auto;left:50%;right:auto;transform:translateX(-50%);gap:26px;}
      .chapter-card{padding:32px 22px;}
      #chapterTitle{font-size:28px;}
      .reactions span{font-size:27px;margin:0 12px;}
    }
  </style>
</head>
<body>

<header>
  <div class="header-inner">
    <div>
      <div class="title">Project-MirAi</div>
      <div class="meta">T√°c gi·∫£: NamuTachi / <strong>MirAi</strong></div>
    </div>
    <div class="controls">
      <button id="toggleTheme" class="btn">Dark</button>
      <button id="fontDec" class="btn">A-</button>
      <button id="fontInc" class="btn">A+</button>
      <button id="tocBtn" class="btn">M·ª•c l·ª•c</button>
    </div>
  </div>
  <div style="max-width:1100px;margin:0 auto;padding:0 20px;">
    <div class="progress-bar"><div id="progress" class="progress"></div></div>
  </div>
</header>

<div class="container">
  <div class="chapter-card">
    <h1 id="chapterTitle">ƒêang t·∫£i...</h1>
    <div class="chapter-meta">
      <span id="chapterNumber"></span> ‚Ä¢ C·∫≠p nh·∫≠t: <span id="chapterDate"></span>
    </div>

    <div class="nav-btns">
      <button id="prevBtn" class="btn">‚óÄ Tr∆∞·ªõc</button>
      <button id="bookmarkBtn" class="btn">Bookmark</button>
      <button id="shareBtn" class="btn">Share</button>
      <button id="nextBtn" class="btn">Sau ‚ñ∂</button>
    </div>

    <div id="content"></div>

    <!-- Reaction ƒëen tr·∫Øng -->
    <div class="reactions">
      <div>C·∫£m x√∫c c·ªßa b·∫°n sau ch∆∞∆°ng n√†y?</div>
      <span id="cry">üò≠</span>
      <span id="shock">üò±</span>
      <span id="angry">ü§¨</span>
      <span id="love">ü•π</span>
      <span id="broken">üíî</span>
      <span id="fire">üî•</span>
      <div id="reactionResult">Ch∆∞a c√≥ ai th·∫£ c·∫£m x√∫c...</div>
    </div>

    <!-- B√¨nh lu·∫≠n FB -->
    <div style="margin:70px 0 40px;border-top:1px solid var(--border);padding-top:40px;">
      <div class="fb-comments" data-href="" data-width="100%" data-numposts="15" data-colorscheme="light" data-lazy="true" data-order-by="reverse_time"></div>
    </div>

    <div class="nav-btns">
      <button id="prevBtnBottom" class="btn">‚óÄ Tr∆∞·ªõc</button>
      <button id="nextBtnBottom" class="btn">Sau ‚ñ∂</button>
    </div>
  </div>
</div>

<!-- Social float -->
<div class="social-float">
  <a href="https://facebook.com/namutachi.mirai" target="_blank" class="fb-bg">f</a>
  <a href="https://discord.gg/abc123xyz" target="_blank" class="dc-bg">D</a>
  <a href="#" target="_blank" class="donate-bg">‚ô•</a>
</div>

<script>
const CHAPTERS = [
  {title:"Ch∆∞∆°ng 1", file:"chapters/chuong-1.html", date:"2025-12-06"},
  {title:"Ch∆∞∆°ng 2", file:"chapters/chuong-2.html", date:"2025-12-10"},
  {title:"Ch∆∞∆°ng 3", file:"chapters/chuong-3.html", date:"2025-12-15"},
];

let current = parseInt(localStorage.getItem('lastChapter') || '0');
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);

// Theme
if(localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)){
  document.documentElement.setAttribute('data-theme','dark');
}
$('#toggleTheme').textContent = document.documentElement.getAttribute('data-theme') === 'dark' ? 'Light' : 'Dark';
$('#toggleTheme').onclick = () => {
  const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
  document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
  localStorage.setItem('theme', isDark ? 'light' : 'dark');
  $('#toggleTheme').textContent = isDark ? 'Dark' : 'Light';
};

// Font
let fsize = parseFloat(localStorage.getItem('fontSize') || '18.5');
$('#content').style.fontSize = fsize + 'px';
$('#fontInc').onclick = () => { fsize += 2; $('#content').style.fontSize = fsize+'px'; localStorage.setItem('fontSize', fsize); };
$('#fontDec').onclick = () => { fsize = Math.max(14, fsize-2); $('#content').style.fontSize = fsize+'px'; localStorage.setItem('fontSize', fsize); };

// Load ch∆∞∆°ng
async function load(){
  const ch = CHAPTERS[current];
  $('#chapterTitle').textContent = ch.title;
  $('#chapterDate').textContent = ch.date;
  $('#chapterNumber').textContent = `${current+1}/${CHAPTERS.length}`;

  try{
    const res = await fetch(ch.file + '?t=' + Date.now());
    if(res.ok){
      const html = await res.text();
      const temp = document.createElement('div');
      temp.innerHTML = html;
      $('#content').innerHTML = (temp.querySelector('#content') || temp.querySelector('body') || temp).innerHTML || '<p style="text-align:center;color:#888;">Ch∆∞∆°ng tr·ªëng</p>';
    }else{
      $('#content').innerHTML = `<p style="text-align:center;color:#888;font-size:19px;">404 - Kh√¥ng t√¨m th·∫•y ch∆∞∆°ng n√†y</p>`;
    }
  }catch{
    $('#content').innerHTML = '<p style="text-align:center;color:#888;">L·ªói t·∫£i ch∆∞∆°ng</p>';
  }

  document.querySelector('.fb-comments').setAttribute('data-href', location.href);
  loadReactions();
  buildTOC();
  restoreScroll();
}
load();

// Reaction
function loadReactions(){
  const key = 'react_' + current;
  const data = JSON.parse(localStorage.getItem(key) || '{}');
  const result = $('#reactionResult');
  if(Object.keys(data).length === 0){
    result.innerHTML = '<span style="color:#888;">Ch∆∞a c√≥ ai th·∫£ c·∫£m x√∫c...</span>';
    return;
  }
  let max = 0, emoji = '';
  for(let k in data){
    if(data[k] > max){ max = data[k]; emoji = k; }
  }
  result.innerHTML = `ƒêa s·ªë ƒëang c·∫£m th·∫•y ${emoji} <strong>${max}</strong> ng∆∞·ªùi`;
}
$$('.reactions span').forEach(span => {
  span.onclick = () => {
    const e = span.innerText;
    const key = 'react_' + current;
    const data = JSON.parse(localStorage.getItem(key) || '{}');
    data[e] = (data[e] || 0) + 1;
    localStorage.setItem(key, JSON.stringify(data));
    span.style.transform = 'scale(1.6)';
    setTimeout(() => span.style.transform = '', 300);
    loadReactions();
  };
});

// Navigation
function prev(){ if(current > 0){ current--; localStorage.setItem('lastChapter', current); load(); } }
function next(){ if(current < CHAPTERS.length-1){ current++; localStorage.setItem('lastChapter', current); load(); } }
$$('#prevBtn, #prevBtnBottom').forEach(b => b.onclick = prev);
$$('#nextBtn, #nextBtnBottom').forEach(b => b.onclick = next);

// TOC mobile
$('#tocBtn').onclick = () => {
  const overlay = document.createElement('div');
  overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.92);z-index:999;display:flex;align-items:center;justify-content:center;padding:20px;';
  let list = '<div style="display:flex;flex-direction:column;gap:10px;">';
  CHAPTERS.forEach((ch,i) => {
    list += `<a href="#" style="padding:16px 20px;border-radius:16px;background:${i===current?'rgba(0,0,0,0.15)':'transparent'};font-weight:${i===current?'600':''};color:var(--text);text-align:center;">${ch.title}</a>`;
  });
  list += '</div>';
  overlay.innerHTML = `<div style="background:var(--card);width:100%;max-width:460px;border-radius:24px;padding:32px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.5);">
    <h3 style="text-align:center;color:var(--text);margin-bottom:24px;font-size:26px;opacity:0.9;">M·ª•c l·ª•c</h3>${list}
    <div style="text-align:center;margin-top:32px;"><button class="btn" onclick="this.closest('div[style]').parentElement.remove()">ƒê√≥ng</button></div>
  </div>`;
  overlay.onclick = e => { if(e.target === overlay) overlay.remove(); };
  document.body.appendChild(overlay);
};

// Progress + scroll
function updateProgress(){
  const h = document.documentElement.scrollHeight - window.innerHeight;
  const s = window.scrollY;
  const p = h > 100 ? (s / h) * 100 : 0;
  $('#progress').style.width = p + '%';
  localStorage.setItem('scroll_' + current, s);
}
window.addEventListener('scroll', updateProgress);
function restoreScroll(){
  const pos = localStorage.getItem('scroll_' + current);
  if(pos) window.scrollTo(0, parseInt(pos));
}
updateProgress();
</script>
</body>
</html>
